!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.rdeck=t():e.rdeck=t()}(self,(function(){return(()=>{var e,t,n,r={6904:(e,t,n)=>{"use strict";n.r(t),n.d(t,{VERSION:()=>jt,Widget:()=>gt,binding:()=>mt,getWidgetById:()=>vt,getWidgets:()=>bt});var r={};n.r(r),n.d(r,{AGGREGATION_OPERATION:()=>c.KM,ArcLayer:()=>l.zv,BitmapLayer:()=>l.hz,CPUGridLayer:()=>c.ab,ColumnLayer:()=>l.eJ,ContourLayer:()=>c.YY,GPUGridLayer:()=>c.ML,GeoJsonLayer:()=>l.UW,GreatCircleLayer:()=>u.GJ,GridCellLayer:()=>l.cJ,GridLayer:()=>c.mU,H3ClusterLayer:()=>u.cH,H3HexagonLayer:()=>u.bW,HeatmapLayer:()=>c.zP,HexagonLayer:()=>c.dX,IconLayer:()=>l.eE,LineLayer:()=>l.Ie,MVTLayer:()=>u.i3,PathLayer:()=>l.nr,PointCloudLayer:()=>l.U5,PolygonLayer:()=>l.dW,QuadkeyLayer:()=>u._k,S2Layer:()=>u.jJ,ScatterplotLayer:()=>l.pU,ScenegraphLayer:()=>d.S,ScreenGridLayer:()=>c.p3,SimpleMeshLayer:()=>d.L,SolidPolygonLayer:()=>l.PJ,TerrainLayer:()=>u.tr,TextLayer:()=>l.AB,Tile3DLayer:()=>u.cY,TileLayer:()=>u.Im,TripsLayer:()=>u.Fw,_AggregationLayer:()=>c.Di,_BinSorter:()=>c.l0,_CPUAggregator:()=>c.oA,_GPUGridAggregator:()=>c.Wc,_MultiIconLayer:()=>l.vb,_TextBackgroundLayer:()=>l._k,_getURLFromTemplate:()=>u.po});n(8559);var i=n(5893),o=n(3935),a=n(7294),s=n(6935),l=n(7786),c=n(9080),u=n(803),d=n(1956),p=n(5395);const h=[0,0,0,255];function f([e,t,n,r=255]){return`rgba(${e}, ${t}, ${n}, ${r/255})`}function y(e,t){return Array.isArray(e)?t||4!==e.length?((t=null!=t?t:[])[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=3===e.length?e[3]:255,t):e:"string"==typeof e?(function(e,t){if(7===e.length){const n=parseInt(e.substring(1),16);t[0]=Math.floor(n/65536),t[1]=Math.floor(n/256%256),t[2]=n%256,t[3]=255}else if(9===e.length){const n=parseInt(e.substring(1),16);t[0]=Math.floor(n/16777216),t[1]=Math.floor(n/65536%256),t[2]=Math.floor(n/256%256),t[3]=n%256}}(e,t=null!=t?t:[]),t):h}var m=n(4634),g=n(4177),v=n(458),b=n(602),j=n(8973),w=n(2625);function x(e){return null!==e&&"object"==typeof e&&"accessor"===e.type}var L=n(8976);function k(e){return x(e)&&"scale"in e}var S=n(9757);function C(e="normal"){switch(e){case"additive":return{[S.Z.BLEND]:!0,blendFunc:[S.Z.SRC_ALPHA,S.Z.DST_ALPHA],blendEquation:S.Z.FUNC_ADD};case"subtractive":return{[S.Z.BLEND]:!0,blendFunc:[S.Z.ONE,S.Z.ONE_MINUS_DST_COLOR,S.Z.SRC_ALPHA,S.Z.DST_ALPHA],blendEquation:[S.Z.FUNC_SUBTRACT,S.Z.FUNC_ADD]};default:return{[S.Z.BLEND]:!0,blendFunc:[S.Z.SRC_ALPHA,S.Z.ONE_MINUS_SRC_ALPHA,S.Z.ONE,S.Z.ONE_MINUS_SRC_ALPHA],blendEquation:[S.Z.FUNC_ADD,S.Z.FUNC_ADD]}}}function N(e){return null!==e&&"object"==typeof e&&"frame"in e}function _(e,{name:t,type:n}){var r,i,o,a;const s=e.frame,l=Object.fromEntries(Object.entries(s).map((([e])=>[e,[]]))),c=Object.keys(e.frame).filter((e=>e!==t)),u=s[t],d=function(e){switch(e){case"MULTIPOINT":return T;case"MULTILINESTRING":return A;case"MULTIPOLYGON":return O;default:throw TypeError(`${e} not supported`)}}(n),p=e=>{for(const t of c)l[t].push(s[t][e])},h=[];for(let n=0;n<e.length;n++){const s=u[n];if(d(s)){l[t].push(...s);for(let t=0;t<s.length;t++)p(n),h.push(null!==(i=null===(r=e.indices)||void 0===r?void 0:r[n])&&void 0!==i?i:n)}else l[t].push(s),p(n),h.push(null!==(a=null===(o=e.indices)||void 0===o?void 0:o[n])&&void 0!==a?a:n)}return{length:l[t].length,geometry:{...e.geometry,[t]:n.replace("MULTI","")},indices:h,frame:l}}function T(e){return Array.isArray(null==e?void 0:e[0])}function A(e){var t;return Array.isArray(null===(t=null==e?void 0:e[0])||void 0===t?void 0:t[0])}function O(e){var t,n;return Array.isArray(null===(n=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t[0])||void 0===n?void 0:n[0])}var E=n(3693),M=n(4717),Z=n(6867),P=n(3326),H=n(2112),I=n(7693),D=n(8569),R=n(1435);class G extends E.Z{initializeState(){if(!function(e){return U.some((t=>e instanceof t))}(this))return;const e=this,t=e.getAttributeManager();t&&t.addInstanced({pickingColors:{type:S.Z.UNSIGNED_BYTE,size:3,accessor:(t,{index:n,data:r,target:i})=>{var o,a,s;if(N(r)&&Array.isArray(r.indices))return e.encodePickingColor(r.indices.indexOf(r.indices[n]),i);const l=null===(a=null===(o=null==t?void 0:t.__source)||void 0===o?void 0:o.parent)||void 0===a?void 0:a.props.data;return N(l)&&Array.isArray(l.indices)?e.encodePickingColor(l.indices.indexOf(l.indices[t.__source.index]),i):e.encodePickingColor(null!==(s=null==t?void 0:t.__source.index)&&void 0!==s?s:n,i)},shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}}const U=[M.Z,Z.Z,P.Z,H.Z,I.Z,D.Z,R.Z];function z(e,...t){if(null==e)return null;const n=t.map((t=>[t,e[t]]));return Object.fromEntries(n)}function F(e){return e.clientHeight>0&&e.clientHeight>0?e:e.parentElement?F(e.parentElement):null}function V(e){const t=F(e);if(e===t||null==t)return[e.clientWidth,e.clientHeight];const{width:n,height:r}=getComputedStyle(e),i=document.createElement("div");Object.assign(i.style,{width:n,height:r,display:"hidden"}),t.appendChild(i);const o=[i.clientWidth,i.clientHeight];return t.removeChild(i),o}function W(e,t){const n=new Map;for(const r of e){const e=t(r);n.has(e)?n.get(e).push(r):n.set(e,[r])}return n}function q(...e){return e.filter((e=>null!=e)).join(" ")}function Y(e,t=0){let n;return(...r)=>{window.clearTimeout(n),n=window.setTimeout((()=>e(...r)),t)}}class ${constructor(){this._val=new Map,this._ref=new WeakMap}getStore(e){return"object"==typeof(t=e)&&null!==t||"function"==typeof t?this._ref:this._val;var t}has(e){return this.getStore(e).has(e)}get(e){return this.getStore(e).get(e)}set(e,t){return this.getStore(e).set(e,t),this}}function B(e){const t=new $;return(...n)=>{const r=n[0],i=n.slice(0,-1).reduceRight(((e,t)=>{if(e.has(t))return e.get(t);const n=new $;return e.set(t,n),n}),t);if(i.has(r))return i.get(r);const o=e(...n);return i.set(r,o),o}}const J=B((function(e){const t=function(e){return Object.entries(e.geometry).filter((([,e])=>/MULTI/.test(e))).map((([e,t])=>({name:e,type:t})))}(e);return 0===t.length?e:t.reduce(_,e)})),K=B(y),X=B((function(e,t){const n=function({col:e,dataType:t},n){if("highlightColor"===n)switch(t){case"table":return function(e){return({index:t,layer:n})=>y(n.props.data.frame[e][t])}(e);case"object":return function(e){return({object:t})=>y(t[e])}(e);case"geojson":return function(e){return({object:t})=>y(t.properties[e])}(e);default:throw TypeError(`${t} not supported`)}if(n.endsWith("Color"))switch(t){case"table":return function(e){return(t,{index:n,data:r,target:i})=>y(r.frame[e][n],i)}(e);case"object":return function(e){return(t,{target:n})=>y(t[e],n)}(e);case"geojson":return function(e){return(t,{target:n})=>y(t.properties[e],n)}(e);default:throw TypeError(`${t} not supported`)}switch(t){case"table":return function(e){return(t,{index:n,data:r})=>r.frame[e][n]}(e);case"object":return function(e){return t=>t[e]}(e);case"geojson":return function(e){return t=>t.properties[e]}(e);default:throw TypeError(`${t} not supported`)}}(e,t);return{...e,getData:n}})),Q=B((function(e,t){"palette"in e&&(e.range=e.palette.map((e=>y(e))),e.unknown=y(e.unknown));const n=function(e){switch(e.scale){case"linear":return(0,m.Z)().domain(e.domain).range(e.range).unknown(e.unknown).clamp(!0);case"power":return(0,g.ZP)().exponent(e.exponent).domain(e.domain).range(e.range).unknown(e.unknown).clamp(!0);case"log":return(0,v.Z)().base(e.base).domain(e.domain).range(e.range).unknown(e.unknown).clamp(!0);case"symlog":return(0,L.eh9)().domain(e.domain).range(e.range).unknown(e.unknown).clamp(!0);case"threshold":case"quantile":return(0,b.Z)().domain(e.domain).range(e.range).unknown(e.unknown);case"category":return(0,j.Z)().domain(e.domain).range(e.range).unknown(e.unknown);case"quantize":return(0,w.Z)().domain(e.domain).range(e.range).unknown(e.unknown);default:throw TypeError(`scale ${e.scale} not supported`)}}(e),r="highlightColor"===t?function({col:e,dataType:t},n){switch(t){case"table":return function(e,t){return({index:n,layer:r})=>{var i;return t(null!==(i=r.props.data.frame[e][n])&&void 0!==i?i:void 0)}}(e,n);case"object":return function(e,t){return({object:n})=>{var r;return t(null!==(r=n[e])&&void 0!==r?r:void 0)}}(e,n);case"geojson":return function(e,t){return({object:n})=>{var r;return t(null!==(r=n.properties[e])&&void 0!==r?r:void 0)}}(e,n);default:throw TypeError(`${t} not supported`)}}(e,n):function({col:e,dataType:t},n){switch(t){case"table":return function(e,t){return(n,{index:r,data:i})=>{var o;return t(null!==(o=i.frame[e][r])&&void 0!==o?o:void 0)}}(e,n);case"object":return function(e,t){return n=>{var r;return t(null!==(r=n[e])&&void 0!==r?r:void 0)}}(e,n);case"geojson":return function(e,t){return n=>{var r;return t(null!==(r=n.properties[e])&&void 0!==r?r:void 0)}}(e,n);default:throw TypeError(`${t} not supported`)}}(e,n);return{...e,name:t,getData:r,scaleData:n}}));class ee{constructor({type:e,...t}){var n,r;const i=Object.entries(t),o=function(e){const t=e.filter(te).map((([e,t])=>[e,K(t)])),n=e.find((([e])=>"colorRange"===e));n&&t.push([n[0],n[1].map((e=>K(e)))]);return t}(i),a=function(e){return e.filter((([,e])=>x(e))).map((([e,t])=>[e,k(t)?Q(t,e):X(t,e)]))}(i);this.type=e;const s=Object.fromEntries([...i,...o,...a.map((([e,t])=>[e,t.getData])),...re(i),["visible",null===(n=t.visible)||void 0===n||n],["updateTriggers",ne(a)],["parameters",(l=t.parameters,c=t.blendingMode,{...l,...C(c)})]]);var l,c;N(s.data)&&(s.data=J(s.data),s.extensions=[new G,...null!==(r=s.extensions)&&void 0!==r?r:[]]),"TileLayer"===e&&(s.renderSubLayers=e=>{const{bbox:{west:t,south:n,east:r,north:i},x:o,y:a,z:s}=e.tile;return new p.Z({...e,data:[{z:s,x:o,y:a}],image:e.data,bounds:[t,n,r,i]})}),this.props=s,this.scales=a.filter((([,e])=>k(e))).map((([,e])=>e)),"TextLayer"===e&&"fonts"in document&&document.fonts.load(`16px ${t.fontFamily}`)}static create(e){return new ee(e)}renderLayer(e){if("TripsLayer"===this.type&&void 0!==e){const t=this.props,{loopLength:n,animationSpeed:r}=t,i=n/r,o=e/1e3%i/i;t.currentTime=o*n}return new r[this.type]({...this.props})}renderLegend(){const e=this.scales.filter((e=>e.legend));return{id:this.props.id,name:this.props.name,scales:e}}renderSelector(){var e;return{id:this.props.id,groupName:this.props.groupName,name:this.props.name,visible:null===(e=this.props.visible)||void 0===e||e}}}function te([e,t]){return e.endsWith("Color")&&(Array.isArray(t)||"string"==typeof t)}function ne(e){const t=e=>{const{getData:t,scaleData:n,palette:r,...i}=e;return i},n=e.map((([e,n])=>[e,t(n)]));return Object.fromEntries(n)}function re(e){return e.filter((([e])=>"getColorWeight"===e||"getElevationWeight"===e)).filter((([,e])=>null!==e&&"function"!=typeof e&&!x(e))).map((([e,t])=>[e,()=>t]))}n(6158);var ie=n(8202),oe=n(2802),ae=n(17),se=n(3295);const le=".feature_id";function ce(e,t=null){if(!e.picked)return null;null==t&&(t=function({object:e,layer:t}){return!N(t.props.data)||t instanceof se.Z?function(e){return"Feature"===(null==e?void 0:e.type)&&"geometry"in e&&"type"in e.geometry}(e)?"geojson":"object":"table"}(e));const n=function(e){switch(e){case"table":return(e,{index:t,data:n})=>{const r=Object.keys(n.geometry),i={};for(const[e,o]of Object.entries(n.frame))r.includes(e)||(i[e]=o[t]);return i};case"object":return e=>({...e});case"geojson":return e=>({[le]:null==e?void 0:e.id,...null==e?void 0:e.properties});default:throw TypeError(`${e} not supported`)}}(t),{object:r,index:i}=e;return n(r,{index:i,data:e.layer.props.data})}const ue="cyWLt4_G7nk5vT9hPr0o",de="Z9hHHet2RXmL0iMel3Zt",pe="jp658yEHLlesSRvwBwDl",he="t9I8kJyjeEJEOArvMD7j",fe="vovHpTur01BROrMLmEFz";function ye({info:e}){if(!e.picked||null==e.layer.props.tooltip)return null;const{x:t,y:n}=e,{name:r,tooltip:o}=e.layer.props,a=ce(e,o.dataType);delete a[le];const s=!0===o.cols?Object.keys(a):o.cols;return(0,i.jsxs)("div",{className:ue,style:{transform:`translate(${t}px, ${n}px)`},children:[(0,i.jsx)("div",{className:de,children:r}),(0,i.jsx)("table",{className:pe,children:(0,i.jsx)("tbody",{children:s.map((e=>{var t;return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:he,children:e}),(0,i.jsx)("td",{className:fe,children:String(null!==(t=a[e])&&void 0!==t?t:null)})]},e)}))})})]})}function me({props:e,layers:t}){const n=(0,a.useRef)(null),[r,o]=ge(),{mapboxAccessToken:s,mapStyle:l,mapOptions:c,controller:u,parameters:d,blendingMode:p,...h}=e,f={...d,...C(p)},[y,m]=(0,a.useState)(0),g=0!==t.filter((e=>"TripsLayer"===e.type)).length;ve(g,(e=>m(e)));const v=t.filter((e=>null!=e.type)).map((e=>e.renderLayer(y)));return(0,i.jsxs)(a.Fragment,{children:[(0,i.jsx)(oe.Z,{ref:n,...h,parameters:f,layers:v,onHover:o,children:(0,i.jsx)(ie.Z,{id:"map",controller:u,repeat:!0,children:l&&(0,i.jsx)(ae.D5,{reuseMaps:!0,mapboxAccessToken:s,mapStyle:l,mapOptions:c})})}),r&&(0,i.jsx)(ye,{info:r})]})}const ge=()=>{const[e,t]=(0,a.useState)(null);return[e,(0,a.useCallback)((e=>{if(!e.picked||!e.layer.props.tooltip||e.layer instanceof se.Z)return t(null);t(e)}),[])]},ve=(e,t)=>{const n=(0,a.useRef)(0),r=(0,a.useRef)(Date.now()),i=()=>{t(Date.now()-r.current),n.current=window.requestAnimationFrame(i)};(0,a.useEffect)((()=>{if(e)return n.current=window.requestAnimationFrame(i),()=>window.cancelAnimationFrame(n.current)}),[e])},be="dePkhbnJCOHYUAj_NSXj",je="UswwkaMDoib4ytc60Zn9",we="ci5EIFzH7r10AG6BsqiG",xe="tc2iXBk_fR6q5GWWpo9m",Le="RYWzL7KGDYHIY2NHbF5X",ke="rn68pqskorQGGcY_sqUg",Se="nYpzg_48IyHFet4DMSbT",Ce="hrbqGf9YJYCqN3_tMI1L",Ne="Nq2XC5CmWGG2PSgH92Tr",_e="njcitPfCPlr7ohpeig92",Te=16;function Ae({layers:e}){return 0===e.length?null:(0,i.jsx)("div",{className:be,children:e.map((e=>(0,i.jsx)(Oe,{...e},e.id)))})}function Oe({name:e,scales:t}){return 0===t.length?null:(0,i.jsxs)("div",{className:je,children:[(0,i.jsx)("div",{className:we,title:e,children:e}),t.map((e=>(0,i.jsx)(Ee,{...e},e.name)))]})}function Ee(e){const t=e.name.replace(/^get/,"").replace(/([A-Z])/g," $1").toLowerCase();const n="palette"in e;const r=function(e){return"linear"===e.scale||"power"===e.scale||"log"===e.scale||"symlog"===e.scale}(e),o=function(e){return"threshold"===e.scale||"quantile"===e.scale||"quantize"===e.scale}(e);return(0,i.jsxs)("div",{className:xe,children:[(0,i.jsx)("div",{className:Le,children:t}),(0,i.jsx)("span",{className:ke,children:"by "}),(0,i.jsx)("span",{className:Se,title:e.col,children:e.col}),n&&r&&(0,i.jsx)(Me,{...e}),n&&o&&(0,i.jsx)(Ze,{...e}),n&&"category"===e.scale&&(0,i.jsx)(Pe,{...e})]})}const Me=({ticks:e,scaleData:t})=>{const n=e.map(((e,t)=>t)).slice(1,-1),r=Te*(e.length-1),o=r+11+1;return(0,i.jsxs)("svg",{className:Ce,height:o,shapeRendering:"crispEdges",children:[(0,i.jsxs)("svg",{y:5,children:[(0,i.jsx)("image",{width:20,height:r,href:Ie(t),preserveAspectRatio:"none"}),n.map((e=>(0,i.jsx)("line",{className:_e,x2:20,y1:Te*e,y2:Te*e},e)))]}),(0,i.jsx)(He,{ticks:e,y:-2})]})},Ze=({ticks:e,range:t})=>{const n=t.map(f),r=Te*(e.length-1)+11+1;return(0,i.jsxs)("svg",{className:Ce,height:r,shapeRendering:"crispEdges",children:[(0,i.jsx)("svg",{y:5,children:n.map(((e,t)=>(0,i.jsx)("rect",{width:20,height:Te,y:t*Te,fill:e},t)))}),(0,i.jsx)(He,{ticks:e,y:-2})]})};function Pe({ticks:e,range:t,unknownTick:n,unknown:r}){const o=n?[...t,r]:t,a=n?[...e,n]:e,s=o.map(f),l=Te*a.length;return(0,i.jsxs)("svg",{className:Ce,height:l,children:[(0,i.jsx)("svg",{children:s.map(((e,t)=>(0,i.jsx)("rect",{width:20,height:14,y:1+t*Te,fill:e},t)))}),(0,i.jsx)(He,{ticks:a})]})}function He({ticks:e,x:t=28,y:n=0}){return(0,i.jsx)("svg",{x:t,y:n,children:e.map(((e,t)=>(0,i.jsx)("text",{className:Ne,y:Te*t,dy:11,children:String(e)},t)))})}function Ie(e,t=200){const n=e.range().length,r=[...Array(n).keys()].map((e=>e/(n-1))),i=e.copy().range(r).invert,o=document.createElement("canvas"),a=o.getContext("2d");o.width=1,o.height=t;for(let n=0;n<t;n++)a.fillStyle=f(e(i(n/t))),a.fillRect(0,n,1,1);return o.toDataURL()}const De="rdeck",Re="S9CJIVXVAK0I3CutdI6g",Ge="YdjmCX6zK6bSK2hf1f10",Ue="UVOq5gxQhkpq8sCqRgI2";var ze=n(148),Fe=n(9816),Ve=n(9826),We=n(6218);const qe="vuAOyD_5tWmY2RPHTuYY",Ye="n6jppVxEBKOj1hSBYZ6_",$e="KQfHmYbZf5cmK9e6t3iK",Be="LZXYw_iUEePVNUQgV40h",Je="DbzmP4_hJ6wY628cSZhG",Ke="xKDjjRbJSZxg0xyD0nAI",Xe="vLGippSuMIytgXuofCKd",Qe="fG18f7ZGepQ_2FcTrPlj",et="mHkJXAoHRaJi5uTJ1HgN",tt="yEmldpPm5pY_q_QOaYBM",nt="s4NzyM8HmUyOUjhwFGTG",rt=Date.now();function it({className:e,tooltip:t,onClick:n,children:r}){return(0,i.jsx)("button",{className:e,type:"button",onClick:n,title:t,children:r})}function ot({layers:e,onVisibilityChange:t}){const n=W(e,(e=>{var t;return null!==(t=e.groupName)&&void 0!==t?t:`${e.name}-${rt}`})),r=(n,r,i)=>{if(i){const i=!e.filter((e=>!n.includes(e))).some((e=>e.visible));return t(e.map((e=>({...e,visible:n.includes(e)?r:i}))))}t(n.map((e=>({...e,visible:r}))))},[o,s]=(0,a.useState)(!1),l=()=>s((e=>!e));return o?(0,i.jsxs)("div",{className:Ye,children:[(0,i.jsx)("div",{className:$e,children:(0,i.jsxs)(it,{className:Be,onClick:l,tooltip:"Close",children:[(0,i.jsx)(ze.Z,{className:nt,fontSize:"small"}),(0,i.jsx)("span",{className:Je,children:"Layers"})]})}),(0,i.jsx)("div",{className:Ke,children:Array.from(n.entries(),(([e,t,[{groupName:n}]=t])=>(0,i.jsx)(at,{group:n,layers:t,onChange:r},e)))})]}):(0,i.jsx)(it,{className:qe,tooltip:"Layer selector",onClick:l,children:(0,i.jsx)(ze.Z,{className:nt,fontSize:"small"})})}function at({group:e,layers:t,onChange:n}){const r=Array.from(W(t,(e=>e.name)),(([e,t])=>(0,i.jsx)(st,{name:e,layers:t,onChange:n},e)));return e?(0,i.jsxs)(a.Fragment,{children:[(0,i.jsx)(st,{name:e,layers:t,onChange:n}),(0,i.jsx)("div",{className:Xe,children:r})]}):(0,i.jsx)(a.Fragment,{children:r})}function st({name:e,layers:t,onChange:n}){const r=function(e){let t=e[0].visible;for(const n of e)if(n.visible!==t)return null;return t}(t),o=null===r,s=(0,a.useRef)(null);(0,a.useEffect)((()=>{s.current&&(s.current.indeterminate=o)}),[o]);const l=(0,a.useRef)((()=>!1)),c=r?Fe.Z:o?Ve.Z:We.Z,u=q(Qe,r||o?et:null);return(0,i.jsxs)("label",{className:u,children:[(0,i.jsx)("input",{ref:s,className:tt,type:"checkbox",onChange:()=>{l.current()?n(t,!0,!0):l.current=lt((()=>n(t,!r,!1)),200)},checked:null==r||r}),(0,i.jsx)(c,{fontSize:"small",className:nt}),(0,i.jsx)("span",{className:Je,children:e})]})}const lt=(e,t=200)=>{const n={current:0};let r=0;const i=o=>{if(r||(r=o),o-r>t)return n.current=0,void e();n.current=globalThis.requestAnimationFrame(i)};return n.current=globalThis.requestAnimationFrame(i),()=>0!==n.current&&(globalThis.cancelAnimationFrame(n.current),n.current=0,!0)};function ct({props:e,layers:t,theme:n,lazyLoad:r,layerSelector:o,onLayerVisibilityChange:l,width:c,height:u}){const{initialBounds:d,initialViewState:p,...h}=e,f=function(e,t,n,r){return(0,a.useMemo)((()=>{if(!Array.isArray(n))return r;const[i,o,a,l]=n,c=[[Math.max(-180,i),Math.max(o,-85.051129)],[Math.min(180,a),Math.min(l,85.051129)]],u=new s.Z({width:e,height:t}),{longitude:d,latitude:p,zoom:h}=u.fitBounds(c);return{...r,longitude:d,latitude:p,zoom:h}}),[n,r,e,t])}(c,u,d,p),y=t.map(ee.create),m=(0,a.useRef)(null),g=function(e,t){const[n,r]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{if(t&&e.current){const t=new IntersectionObserver((e=>{r(e[0].isIntersecting)}),{threshold:0});return t.observe(e.current),()=>t.disconnect()}}),[t,e]),n}(m,r),v=!r||g;return(0,i.jsxs)("div",{ref:m,className:q(De,n),children:[(0,i.jsx)("div",{className:q(Re,Ge),children:o&&(0,i.jsx)(ot,{layers:y.filter((e=>e.props.visibilityToggle)).map((e=>e.renderSelector())).reverse(),onVisibilityChange:l})}),v&&(0,i.jsx)(me,{props:{...h,initialViewState:f},layers:y}),(0,i.jsx)("div",{className:q(Re,Ue),children:(0,i.jsx)(Ae,{layers:y.filter((e=>e.props.visible)).map((e=>e.renderLegend())).reverse()})})]})}function ut(e){const t=e instanceof s.Z?e:new s.Z(e),n=z(t,"longitude","latitude","zoom","bearing","pitch","altitude");return{bounds:t.getBounds(),viewState:{...n,center:t.unprojectFlat(t.center)}}}var dt,pt,ht,ft=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},yt=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};const mt={name:"rdeck",type:"output",factory:(e,t,n)=>(0!==t&&0!==n||([t,n]=V(e)),new gt(e,t,n))};class gt{constructor(e,t,n){if(dt.set(this,void 0),pt.set(this,void 0),ht.set(this,void 0),this.props={blendingMode:"normal"},this.layers=[],this.theme="kepler",this.layerSelector=!0,this.lazyLoad=!1,ft(this,dt,e,"f"),ft(this,pt,t,"f"),ft(this,ht,n,"f"),this.onClick=this.onClick.bind(this),this.onViewStateChange=this.onViewStateChange.bind(this),HTMLWidgets.shinyMode){const t=Y(((e={})=>this.renderValue(e)),50);Shiny.addCustomMessageHandler(`${e.id}:layer`,(e=>{var n,r,i;const o=this.layers.find((t=>t.id===e.id)),a={...o,...e,visible:null!==(n=e.visible)&&void 0!==n?n:null==o?void 0:o.visible,data:null!==(i=null!==(r=e.data)&&void 0!==r?r:null==o?void 0:o.data)&&void 0!==i?i:null};this.layers=null==o?[...this.layers,a]:this.layers.map((e=>e===o?a:e)),t({layers:this.layers})})),Shiny.addCustomMessageHandler(`${e.id}:deck`,(({props:e,theme:t,lazyLoad:n})=>{this.renderValue({props:{...this.props,...e},theme:t,lazyLoad:n})}))}this.setLayerVisibility=this.setLayerVisibility.bind(this)}renderValue({props:e,layers:t,theme:n,layerSelector:r,lazyLoad:a}={}){const s={props:{...this.props,...e,onClick:this.onClick,onViewStateChange:Y(this.onViewStateChange,50)},layers:null!=t?t:this.layers,theme:null!=n?n:this.theme,layerSelector:null!=r?r:this.layerSelector,lazyLoad:null!=a?a:this.lazyLoad};Object.assign(this,s),o.render((0,i.jsx)(ct,{...s,onLayerVisibilityChange:this.setLayerVisibility,width:yt(this,pt,"f"),height:yt(this,ht,"f")}),yt(this,dt,"f"))}resize(e,t){}get id(){return yt(this,dt,"f").id}setLayerVisibility(e){if(0===e.length)return;const t=this.layers.map((t=>{const n=e.find((e=>((e,t)=>{const n=e.name===t.name,r=e.groupName===t.groupName;return n&&r||null==e.name&&null!=e.groupName&&r})(e,t)&&e.visible!==t.visible));return n?{...t,visible:n.visible}:t}));this.renderValue({layers:t})}onClick(e){var t;if(HTMLWidgets.shinyMode){const n={coordinate:e.coordinate,...ut(e.viewport),layer:z(null===(t=e.layer)||void 0===t?void 0:t.props,"id","name","groupName"),object:ce(e)};Shiny.setInputValue(`${this.id}_click`,n,{priority:"event"})}}onViewStateChange({viewState:e}){if(HTMLWidgets.shinyMode){const t=ut(e);Shiny.setInputValue(`${this.id}_viewstate`,t,{priority:"event"})}}}function vt(e){var t;const n=document.getElementById(e);return null!==(t=null==n?void 0:n.htmlwidget_data_init_result)&&void 0!==t?t:null}function bt(){return[...document.querySelectorAll(".rdeck.html-widget")].map((e=>e.htmlwidget_data_init_result)).filter((e=>e instanceof gt))}dt=new WeakMap,pt=new WeakMap,ht=new WeakMap,HTMLWidgets.widget(mt);const jt="0.4.0-dev"},9521:()=>{},9125:()=>{},9214:()=>{}},i={};function o(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return r[e].call(n.exports,n,n.exports,o),n.exports}o.m=r,e=[],o.O=(t,n,r,i)=>{if(!n){var a=1/0;for(u=0;u<e.length;u++){for(var[n,r,i]=e[u],s=!0,l=0;l<n.length;l++)(!1&i||a>=i)&&Object.keys(o.O).every((e=>o.O[e](n[l])))?n.splice(l--,1):(s=!1,i<a&&(a=i));if(s){e.splice(u--,1);var c=r();void 0!==c&&(t=c)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[n,r,i]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var i=Object.create(null);o.r(i);var a={};t=t||[null,n({}),n([]),n(n)];for(var s=2&r&&e;"object"==typeof s&&!~t.indexOf(s);s=n(s))Object.getOwnPropertyNames(s).forEach((t=>a[t]=()=>e[t]));return a.default=()=>e,o.d(i,a),i},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={8472:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var r,i,[a,s,l]=n,c=0;if(a.some((t=>0!==e[t]))){for(r in s)o.o(s,r)&&(o.m[r]=s[r]);if(l)var u=l(o)}for(t&&t(n);c<a.length;c++)i=a[c],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return o.O(u)},n=self.webpackChunkrdeck=self.webpackChunkrdeck||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=o.O(void 0,[5486,3474,3619,2568,8627,9688,3928,2202,8811,9784,2324,6042,3899,1667,9134,4745,7535,1528,8422,1378,1877,341,1394,6354,9816,7485,7650,3869,4092,1283,2055,9067,6014,3645,7806,1282,1836,8096,6813,3451,912,6261,2247,5590,2355,3953,7044,9538,49,6639,4360,4825,1596],(()=>o(6904)));return a=o.O(a)})()}));