(self.webpackChunkrdeck=self.webpackChunkrdeck||[]).push([[474],{7402:(e,t,r)=>{"use strict";r.d(t,{Z:()=>se});var n=r(4550),s=r(8744);const i={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect"};Object.keys(i);var o=r(8338);function a(e,t,r){(0,o.Z)(e instanceof ArrayBuffer);const n=new TextDecoder("utf8"),s=new Uint8Array(e,t,r);return n.decode(s)}var c=r(3353);const u={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},l={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,...u};var h=r(7720);const f={[u.DOUBLE]:Float64Array,[u.FLOAT]:Float32Array,[u.UNSIGNED_SHORT]:Uint16Array,[u.UNSIGNED_INT]:Uint32Array,[u.UNSIGNED_BYTE]:Uint8Array,[u.BYTE]:Int8Array,[u.SHORT]:Int16Array,[u.INT]:Int32Array},d={DOUBLE:u.DOUBLE,FLOAT:u.FLOAT,UNSIGNED_SHORT:u.UNSIGNED_SHORT,UNSIGNED_INT:u.UNSIGNED_INT,UNSIGNED_BYTE:u.UNSIGNED_BYTE,BYTE:u.BYTE,SHORT:u.SHORT,INT:u.INT},p="Failed to convert GL type";class y{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in f){if(f[t]===e)return t}throw new Error(p)}static fromName(e){const t=d[e];if(!t)throw new Error(p);return t}static getArrayType(e,t=!1){switch(e){case u.UNSIGNED_SHORT_5_6_5:case u.UNSIGNED_SHORT_4_4_4_4:case u.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=f[e];if(!t)throw new Error(p);return t}}static getByteSize(e){return y.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return Boolean(y.getArrayType(e))}static createTypedArray(e,t,r=0,n){void 0===n&&(n=(t.byteLength-r)/y.getByteSize(e));return new(y.getArrayType(e))(t,r,n)}}class g{constructor(e,t){this.json=e,this.buffer=t,this.featuresLength=0,this._cachedTypedArrays={}}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return Boolean(this.json[e])}getGlobalProperty(e,t=l.UNSIGNED_INT,r=1){const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(e,t,r,1,n.byteOffset):n}getPropertyArray(e,t,r){const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(t=y.fromName(n.componentType)),this._getTypedArrayFromBinary(e,t,r,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(e,t,n)}getProperty(e,t,r,n,s){const i=this.json[e];if(!i)return i;const o=this.getPropertyArray(e,t,r);if(1===r)return o[n];for(let e=0;e<r;++e)s[e]=o[r*n+e];return s}_getTypedArrayFromBinary(e,t,r,n,s){const i=this._cachedTypedArrays;let o=i[e];return o||(o=y.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+s,n*r),i[e]=o),o}_getTypedArrayFromArray(e,t,r){const n=this._cachedTypedArrays;let s=n[e];return s||(s=y.createTypedArray(t,r),n[e]=s),s}}const m={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},b={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},_={SCALAR:(e,t,r)=>{t[r]=e},VEC2:(e,t,r)=>{t[2*r+0]=e[0],t[2*r+1]=e[1]},VEC3:(e,t,r)=>{t[3*r+0]=e[0],t[3*r+1]=e[1],t[3*r+2]=e[2]},VEC4:(e,t,r)=>{t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT2:(e,t,r)=>{t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT3:(e,t,r)=>{t[9*r+0]=e[0],t[9*r+1]=e[1],t[9*r+2]=e[2],t[9*r+3]=e[3],t[9*r+4]=e[4],t[9*r+5]=e[5],t[9*r+6]=e[6],t[9*r+7]=e[7],t[9*r+8]=e[8],t[9*r+9]=e[9]},MAT4:(e,t,r)=>{t[16*r+0]=e[0],t[16*r+1]=e[1],t[16*r+2]=e[2],t[16*r+3]=e[3],t[16*r+4]=e[4],t[16*r+5]=e[5],t[16*r+6]=e[6],t[16*r+7]=e[7],t[16*r+8]=e[8],t[16*r+9]=e[9],t[16*r+10]=e[10],t[16*r+11]=e[11],t[16*r+12]=e[12],t[16*r+13]=e[13],t[16*r+14]=e[14],t[16*r+15]=e[15]}};const T=e=>void 0!==e;function w(e,t,r){if(!t)return null;let n=e.getExtension("3DTILES_batch_table_hierarchy");const s=t.HIERARCHY;return s&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=s,n=s),n?function(e,t){let r,n,s;const i=e.instancesLength,o=e.classes,a=e.classIds,c=e.parentCounts,u=e.parentIds,l=i;T(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,s=getBinaryAccessor(a),a=s.createArrayBufferView(t.buffer,t.byteOffset+a.byteOffset,i));let h;if(T(c))for(T(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,s=getBinaryAccessor(c),c=s.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,i)),h=new Uint16Array(i),l=0,r=0;r<i;++r)h[r]=l,l+=c[r];T(u)&&T(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,s=getBinaryAccessor(u),u=s.createArrayBufferView(t.buffer,t.byteOffset+u.byteOffset,l));const f=o.length;for(r=0;r<f;++r){const e=o[r].length,n=o[r].instances,s=getBinaryProperties(e,n,t);o[r].instances=combine(s,n)}const d=new Array(f).fill(0),p=new Uint16Array(i);for(r=0;r<i;++r)n=a[r],p[r]=d[n],++d[n];const y={classes:o,classIds:a,classIndexes:p,parentCounts:c,parentIndexes:h,parentIds:u};return function(e){const t=e.classIds.length;for(let r=0;r<t;++r)E(e,r,stack)}(y),y}(n,r):null}function A(e,t,r){if(!e)return;const n=e.parentCounts;return e.parentIds?r(e,t):n>0?function(e,t,r){const n=e.classIds,s=e.parentCounts,i=e.parentIds,o=e.parentIndexes,a=n.length,c=scratchVisited;c.length=Math.max(c.length,a);const u=++marker,l=scratchStack;l.length=0,l.push(t);for(;l.length>0;){if(c[t=l.pop()]===u)continue;c[t]=u;const n=r(e,t);if(T(n))return n;const a=s[t],h=o[t];for(let e=0;e<a;++e){const r=i[h+e];r!==t&&l.push(r)}}return null}(e,t,r):function(e,t,r){let n=!0;for(;n;){const s=r(e,t);if(T(s))return s;const i=e.parentIds[t];n=i!==t,t=i}throw new Error("traverseHierarchySingleParent")}(e,t,r)}function E(e,t,r){const n=e.parentCounts,s=e.parentIds,i=e.parentIndexes,o=e.classIds.length;if(!T(s))return;assert(t<o,"Parent index ".concat(t," exceeds the total number of instances: ").concat(o)),assert(-1===r.indexOf(t),"Circular dependency detected in the batch table hierarchy."),r.push(t);const a=T(n)?n[t]:1,c=T(n)?i[t]:t;for(let n=0;n<a;++n){const i=s[c+n];i!==t&&E(e,i,r)}r.pop(t)}function I(e){return null!=e}const v=(e,t)=>e,x={HIERARCHY:!0,extensions:!0,extras:!0};class O{constructor(e,t,r,n={}){(0,o.Z)(r>=0),this.json=e||{},this.binary=t,this.featureCount=r,this._extensions=this.json&&this.json.extensions||{},this._properties={};for(const e in this.json)x[e]||(this._properties[e]=this.json[e]);this._binaryProperties=this._initializeBinaryProperties(),n["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=w(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),(0,o.Z)("string"==typeof t,t),this._hierarchy){return I(A(this._hierarchy,e,((e,r)=>{const n=e.classIds[r];return e.classes[n].name===t})))}return!1}isExactClass(e,t){return(0,o.Z)("string"==typeof t,t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),(0,o.Z)("string"==typeof t,t),I(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),(t=I(t)?t:[]).length=0;const r=Object.keys(this._properties);return t.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),(0,o.Z)("string"==typeof t,t),this._binaryProperties){const r=this._binaryProperties[t];if(I(r))return this._getBinaryProperty(r,e)}const r=this._properties[t];if(I(r))return v(r[e]);if(this._hierarchy){const r=this._getHierarchyProperty(e,t);if(I(r))return r}}setProperty(e,t,r){const n=this.featureCount;if(this._checkBatchId(e),(0,o.Z)("string"==typeof t,t),this._binaryProperties){const n=this._binaryProperties[t];if(n)return void this._setBinaryProperty(n,e,r)}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,r))return;let s=this._properties[t];I(s)||(this._properties[t]=new Array(n),s=this._properties[t]),s[e]=v(r)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,r){e.pack(r,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const r=this._properties[t],n=this._initializeBinaryProperty(t,r);n&&(e=e||{},e[t]=n)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const r=t;(0,o.Z)(this.binary,"Property ".concat(e," requires a batch table binary.")),(0,o.Z)(r.type,"Property ".concat(e," requires a type."));const n=function(e,t,r,n){const{componentType:s}=e;(0,o.Z)(e.componentType);const i="string"==typeof s?y.fromName(s):s,a=m[e.type],c=b[e.type],u=_[e.type];return r+=e.byteOffset,{values:y.createTypedArray(i,t,r,a*n),type:i,size:a,unpacker:c,packer:u}}(r,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const r=A(this._hierarchy,e,((e,r)=>{const n=e.classIds[r];return I(e.classes[n].instances[t])}));return I(r)}_getPropertyNamesInHierarchy(e,t){A(this._hierarchy,e,((e,r)=>{const n=e.classIds[r],s=e.classes[n].instances;for(const e in s)s.hasOwnProperty(e)&&-1===t.indexOf(e)&&t.push(e)}))}_getHierarchyProperty(e,t){return A(this._hierarchy,e,((e,r)=>{const n=e.classIds[r],s=e.classes[n],i=e.classIndexes[r],o=s.instances[t];return I(o)?I(o.typedArray)?this._getBinaryProperty(o,i):v(o[i]):null}))}_setHierarchyProperty(e,t,r,n){const s=A(this._hierarchy,t,((e,s)=>{const i=e.classIds[s],a=e.classes[i],c=e.classIndexes[s],u=a.instances[r];return!!I(u)&&((0,o.Z)(s===t,'Inherited property "'.concat(r,'" is read-only.')),I(u.typedArray)?this._setBinaryProperty(u,c,n):u[c]=v(n),!0)}));return I(s)}}function S(e,t,r=0){const n=new DataView(t);if(e.magic=n.getUint32(r,!0),r+=4,e.version=n.getUint32(r,!0),r+=4,e.byteLength=n.getUint32(r,!0),r+=4,1!==e.version)throw new Error("3D Tile Version ".concat(e.version," not supported"));return r}function P(e,t,r){const n=new DataView(t);return e.header=e.header||{},e.header.featureTableJsonByteLength=n.getUint32(r,!0),r+=4,e.header.featureTableBinaryByteLength=n.getUint32(r,!0),r+=4,e.header.batchTableJsonByteLength=n.getUint32(r,!0),r+=4,e.header.batchTableBinaryByteLength=n.getUint32(r,!0),r+=4}function C(e,t,r,n){return r=function(e,t,r,n){const{featureTableJsonByteLength:s,featureTableBinaryByteLength:i}=e.header;if(e.featureTableJson={BATCH_LENGTH:0},s>0){const n=a(t,r,s);e.featureTableJson=JSON.parse(n)}return r+=s,e.featureTableBinary=new Uint8Array(t,r,i),r+=i}(e,t,r),r=function(e,t,r,n){const{batchTableJsonByteLength:s,batchTableBinaryByteLength:i}=e.header;if(s>0){const n=a(t,r,s);e.batchTableJson=JSON.parse(n),r+=s,i>0&&(e.batchTableBinary=new Uint8Array(t,r,i),e.batchTableBinary=new Uint8Array(e.batchTableBinary),r+=i)}return r}(e,t,r)}function R(e,t=[0,0,0]){const r=e>>11&31,n=e>>5&63,s=31&e;return t[0]=r<<3,t[1]=n<<2,t[2]=s<<3,t}function U(e,t,r){if(!(t||e&&e.batchIds&&r))return null;const{batchIds:n,isRGB565:s,pointCount:i}=e;if(n&&r){const e=new Uint8ClampedArray(3*i);for(let t=0;t<i;t++){const s=n[t],i=r.getProperty(s,"dimensions").map((e=>255*e));e[3*t]=i[0],e[3*t+1]=i[1],e[3*t+2]=i[2]}return{type:l.UNSIGNED_BYTE,value:e,size:3,normalized:!0}}if(s){const e=new Uint8ClampedArray(3*i);for(let r=0;r<i;r++){const n=R(t[r]);e[3*r]=n[0],e[3*r+1]=n[1],e[3*r+2]=n[2]}return{type:l.UNSIGNED_BYTE,value:e,size:3,normalized:!0}}return t&&t.length===3*i?{type:l.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:l.UNSIGNED_BYTE,value:t,size:4,normalized:!0}}var N=r(7363),M=r(7898);new N.Z,new h.Z,new N.Z,new N.Z,new Uint8Array(1);function L(e,t=255){return(0,M.uZ)(e,0,t)/t*2-1}function D(e){return e<0?-1:1}function V(e,t,r,n){if(function(e,t){if(!e)throw new Error("math.gl assertion failed. ".concat(t))}(n),e<0||e>r||t<0||t>r)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(r));if(n.x=L(e,r),n.y=L(t,r),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const e=n.x;n.x=(1-Math.abs(n.y))*D(e),n.y=(1-Math.abs(e))*D(n.y)}return n.normalize()}function B(e,t,r){return V(e,t,255,r)}const j=new h.Z;function k(e,t,r){return e.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,function(e,t){const r=new h.Z,n=new Float32Array(3*e.pointCount);for(let s=0;s<e.pointCount;s++)r.set(t[3*s],t[3*s+1],t[3*s+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(n,3*s);return n}(e,t)):{type:l.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}async function F(e,t,r,n,s){r=C(e,t,r=P(e,t,r=S(e,t,r))),function(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}(e);const{featureTable:i,batchTable:o}=function(e){const t=new g(e.featureTableJson,e.featureTableBinary),r=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=r,e.featuresLength=r,e.pointsLength=r,e.pointCount=r,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",l.FLOAT,3);const n=function(e,t){let r=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",l.UNSIGNED_SHORT,1),e.batchIds)){const n=t.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:s,batchTableBinary:i}=e;r=new O(s,i,n)}return r}(e,t);return{featureTable:t,batchTable:n}}(e);return await async function(e,t,r,n,s){let i,o,a;const u=e.batchTableJson&&e.batchTableJson.extensions&&e.batchTableJson.extensions["3DTILES_draco_point_compression"];u&&(a=u.properties);const l=t.getExtension("3DTILES_draco_point_compression");if(l){o=l.properties;const t=l.byteOffset,r=l.byteLength;if(!o||!Number.isFinite(t)||!r)throw new Error("Draco properties, byteOffset, and byteLength must be defined");i=e.featureTableBinary.slice(t,t+r),e.hasPositions=Number.isFinite(o.POSITION),e.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),e.hasNormals=Number.isFinite(o.NORMAL),e.hasBatchIds=Number.isFinite(o.BATCH_ID),e.isTranslucent=Number.isFinite(o.RGBA)}if(!i)return!0;const f={buffer:i,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await async function(e,t,r,n){const{parse:s}=n,i=await s(t.buffer,c.V,{draco:{extraAttributes:t.batchTableProperties||{}}}),o=i.attributes.POSITION&&i.attributes.POSITION.value,a=i.attributes.COLOR_0&&i.attributes.COLOR_0.value,u=i.attributes.NORMAL&&i.attributes.NORMAL.value,l=i.attributes.BATCH_ID&&i.attributes.BATCH_ID.value,f=o&&i.attributes.POSITION.value.quantization,d=u&&i.attributes.NORMAL.value.quantization;if(f){const t=i.POSITION.data.quantization,r=t.range;e.quantizedVolumeScale=new h.Z(r,r,r),e.quantizedVolumeOffset=new h.Z(t.minValues),e.quantizedRange=(1<<t.quantizationBits)-1,e.isQuantizedDraco=!0}d&&(e.octEncodedRange=(1<<i.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0);const p={};if(t.batchTableProperties)for(const e of Object.keys(t.batchTableProperties))i.attributes[e]&&i.attributes[e].value&&(p[e.toLowerCase()]=i.attributes[e].value);e.attributes={positions:o,colors:U(e,a),normals:u,batchIds:l,...p}}(e,f,0,s)}(e,i,0,0,s),function(e,t,r){if(!e.attributes.positions)if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",l.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const n=t.getPropertyArray("POSITION_QUANTIZED",l.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",l.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",l.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=k(e,n,r)}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}(e,i,n),function(e,t,r){if(!e.attributes.colors){let n=null;t.hasProperty("RGBA")?(n=t.getPropertyArray("RGBA",l.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?n=t.getPropertyArray("RGB",l.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(n=t.getPropertyArray("RGB565",l.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=U(e,n,r)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",l.UNSIGNED_BYTE,4))}(e,i,o),function(e,t){if(!e.attributes.normals){let r=null;t.hasProperty("NORMAL")?r=t.getPropertyArray("NORMAL",l.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(r=t.getPropertyArray("NORMAL_OCT16P",l.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=function(e,t){if(!t)return null;if(e.isOctEncoded16P){const r=new Float32Array(3*e.pointsLength);for(let n=0;n<e.pointsLength;n++)B(t[2*n],t[2*n+1],j),j.toArray(r,3*n);return{type:l.FLOAT,size:2,value:r}}return{type:l.FLOAT,size:2,value:t}}(e,r)}}(e,i),r}var G=r(4801),q=r(1270);const z=0,Z=1;function H(e,t,r,n){e.rotateYtoZ=!0;const s=e.byteOffset+e.byteLength-r;if(0===s)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=(0,q.Aj)(t,r,s),e.gltfByteOffset=0,e.gltfByteLength=s,r%4==0||console.warn("".concat(e.type,": embedded glb is not aligned to a 4-byte boundary.")),e.byteOffset+e.byteLength}async function W(e,t,r,n){const s=r["3d-tiles"]||{};if(function(e,t,r){switch(t){case z:const t=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),r=(new TextDecoder).decode(t);e.gltfUrl=r.replace(/[\s\0]+$/,""),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case Z:break;default:throw new Error("b3dm: Illegal glTF format field")}}(e,t),s.loadGLTF){const{parse:t,fetch:s}=n;e.gltfUrl&&(e.gltfArrayBuffer=await s(e.gltfUrl,r),e.gltfByteOffset=0),e.gltfArrayBuffer&&(e.gltf=await t(e.gltfArrayBuffer,G.Z,r,n),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength)}}async function Q(e,t,r,n,s){r=function(e,t,r,n,s){r=S(e,t,r),r=P(e,t,r),r=C(e,t,r),r=H(e,t,r,n);const i=new g(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=i.getGlobalProperty("RTC_CENTER",l.FLOAT,3),r}(e,t,r,n),await W(e,Z,n,s);const{extensions:i}=e.gltf||{};return i&&i.CESIUM_RTC&&(e.rtcCenter=i.CESIUM_RTC.center),r}var J=r(5109),Y=r(4553),X=r(2425),K=r(8581);async function $(e,t,r,n,s){return r=function(e,t,r,n,s){if(r=S(e,t,r),1!==e.version)throw new Error("Instanced 3D Model version ".concat(e.version," is not supported"));r=P(e,t,r);const i=new DataView(t);if(e.gltfFormat=i.getUint32(r,!0),r=C(e,t,r+=4),r=H(e,t,r,n),0===e.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new g(e.featureTableJson,e.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=o.getGlobalProperty("RTC_CENTER",l.FLOAT,3);new O(e.batchTableJson,e.batchTableBinary,a);return function(e,t,r,n){const s=[new Array(n),e._batchTable][0],i=new h.Z,o=new h.Z,a=new h.Z,c=new h.Z,u=new J.Z,f=new Y.Z,d=new h.Z,p={},y=new X.Z,g=[],m=[],b=new h.Z,_=new h.Z;for(let r=0;r<n;r++){let n;if(t.hasProperty("POSITION"))n=t.getProperty("POSITION",l.FLOAT,3,r,i);else if(t.hasProperty("POSITION_QUANTIZED")){n=t.getProperty("POSITION_QUANTIZED",l.UNSIGNED_SHORT,3,r,i);const e=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",l.FLOAT,3,b);if(!e)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const s=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",l.FLOAT,3,_);if(!s)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const o=65535;for(let t=0;t<3;t++)n[t]=n[t]/o*s[t]+e[t]}if(!n)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");i.copy(n),p.translation=i,e.normalUp=t.getProperty("NORMAL_UP",l.FLOAT,3,r,g),e.normalRight=t.getProperty("NORMAL_RIGHT",l.FLOAT,3,r,m);const h=!1;if(e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",l.UNSIGNED_SHORT,2,g),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",l.UNSIGNED_SHORT,2,m),e.octNormalUp){if(!e.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}e.eastNorthUp?(K.H.WGS84.eastNorthUpToFixedFrame(i,y),y.getRotationMatrix3(u)):u.identity()}h&&(c.copy(o).cross(a).normalize(),u.setColumn(0,o),u.setColumn(1,a),u.setColumn(2,c)),f.fromMatrix3(u),p.rotation=f,d.set(1,1,1);const T=t.getProperty("SCALE",l.FLOAT,1,r);Number.isFinite(T)&&d.multiplyByScalar(T);const w=t.getProperty("SCALE_NON_UNIFORM",l.FLOAT,3,r,g);w&&d.scale(w),p.scale=d;let A=t.getProperty("BATCH_ID",l.UNSIGNED_SHORT,1,r);void 0===A&&(A=r);const E=(new X.Z).fromQuaternion(p.rotation);y.identity(),y.translate(p.translation),y.multiplyRight(E),y.scale(p.scale);const I=y.clone();s[r]={modelMatrix:I,batchId:A}}e.instances=s}(e,o,0,a),r}(e,t,r,n),await W(e,e.gltfFormat,n,s),r}async function ee(e,t=0,r,n,s={}){switch(s.byteOffset=t,s.type=function(e,t=0){const r=new DataView(e);return"".concat(String.fromCharCode(r.getUint8(t+0))).concat(String.fromCharCode(r.getUint8(t+1))).concat(String.fromCharCode(r.getUint8(t+2))).concat(String.fromCharCode(r.getUint8(t+3)))}(e,t),s.type){case i.COMPOSITE:return await async function(e,t,r,n,s,i){r=S(e,t,r);const o=new DataView(t);for(e.tilesLength=o.getUint32(r,!0),r+=4,e.tiles=[];e.tiles.length<e.tilesLength&&e.byteLength-r>12;){const o={};e.tiles.push(o),r=await i(t,r,n,s,o)}return r}(s,e,t,r,n,ee);case i.BATCHED_3D_MODEL:return await Q(s,e,t,r,n);case i.INSTANCED_3D_MODEL:return await $(s,e,t,r,n);case i.POINT_CLOUD:return await F(s,e,t,r,n);default:throw new Error("3DTileLoader: unknown type ".concat(s.type))}}function te(e,t){if(e.content){const r=e.content.uri||e.content.url;e.contentUrl="".concat(t.basePath,"/").concat(r)}return e.id=e.contentUrl,e.lodMetricType=s.ci.GEOMETRIC_ERROR,e.lodMetricValue=e.geometricError,e.transformMatrix=e.transform,e.type=function(e){if(!e.contentUrl)return s.R7.EMPTY;const t=e.contentUrl.split(".").pop();switch(t){case"pnts":return s.R7.POINTCLOUD;case"i3dm":case"b3dm":return s.R7.SCENEGRAPH;default:return t}}(e),e.refine=function(e){switch(e){case"REPLACE":case"replace":return s.F$.REPLACE;case"ADD":case"add":return s.F$.ADD;default:return e}}(e.refine),e}async function re(e,t,r){const i=JSON.parse((new TextDecoder).decode(e));var o;return i.loader=t.loader||ne,i.url=r.url,i.basePath=(o=i,n.X(o.url)),i.root=function(e){const t=e.basePath,r=te(e.root,e),n=[];for(n.push(r);n.length>0;){const e=n.pop().children||[];for(const r of e)te(r,{basePath:t}),n.push(r)}return r}(i),i.type=s.i3.TILES3D,i.lodMetricType=s.ci.GEOMETRIC_ERROR,i.lodMetricValue=i.root.lodMetricValue,i}const ne={id:"3d-tiles",name:"3D Tiles",version:"2.3.13",extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:async function(e,t,r,n){const s=t["3d-tiles"]||{};let i;return i="auto"===s.isTileset?r.url&&-1!==r.url.indexOf(".json"):s.isTileset,e=i?await re(e,t,r):await async function(e,t,r){const n={};return n.content=n.content||{},await ee(e,0,t,r,n.content),n.content}(e,t,r)},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",tile:null,tileset:null,assetGltfUpAxis:null}}},se=ne},7491:(e,t,r)=>{"use strict";r.d(t,{Kn:()=>i,Ss:()=>o,TW:()=>a,D0:()=>c,Ew:()=>u,Lj:()=>l,zH:()=>h,Os:()=>f});const n=e=>"boolean"==typeof e,s=e=>"function"==typeof e,i=e=>null!==e&&"object"==typeof e,o=e=>i(e)&&e.constructor==={}.constructor,a=e=>e&&"function"==typeof e[Symbol.iterator],c=e=>e&&"function"==typeof e[Symbol.asyncIterator],u=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,l=e=>"undefined"!=typeof Blob&&e instanceof Blob,h=e=>e&&"object"==typeof e&&e.isBuffer,f=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||i(e)&&s(e.tee)&&s(e.cancel)&&s(e.getReader))(e)||(e=>i(e)&&s(e.read)&&s(e.pipe)&&n(e.readable))(e)},5431:(e,t,r)=>{"use strict";r.d(t,{z:()=>j});var n=r(7491),s=r(2937),i=r(1174),o=r(8338);function a(e){const t=e.split(".").map(Number);return{major:t[0],minor:t[1]}}var c=r(2631);async function u(e,t,r){return await new Promise(((n,s)=>{const i=e.slice(t,r),o=new FileReader;o.onload=e=>n(e.target&&e.target.result),o.onerror=e=>s(e),o.readAsArrayBuffer(i)}))}var l=r(8774);function h(e){if(l.jU||l.T4>=10){if("function"==typeof e[Symbol.asyncIterator])return async function*(e){for await(const t of e)yield(0,c.rJ)(t)}(e);if("function"==typeof e.getIterator)return e.getIterator()}return l.jU?async function*(e){const t=e.getReader();try{for(;;){const{done:e,value:r}=await t.read();if(e)return;yield(0,c.rJ)(r)}}catch(e){t.releaseLock()}}(e):async function*(e){e=await e;for(;;){const t=e.read();if(null===t){if(e._readableState.ended)return;await f(e)}else yield(0,c.rJ)(t)}}(e)}async function f(e){return new Promise((t=>{e.once("readable",t)}))}function d(e,t={}){return"string"==typeof e?function*(e,t={}){const{chunkSize:r=262144}=t;let n=0;const s=new TextEncoder;for(;n<e.length;){const t=Math.min(e.length-n,r),i=e.slice(n,n+t);n+=t,yield s.encode(i)}}(e,t):e instanceof ArrayBuffer?function*(e,t={}){const{chunkSize:r=262144}=t;let n=0;for(;n<e.byteLength;){const t=Math.min(e.byteLength-n,r),s=new ArrayBuffer(t),i=new Uint8Array(e,n,t);new Uint8Array(s).set(i),n+=t,yield s}}(e,t):(0,n.Lj)(e)?async function*(e,t={}){const r=t.chunkSize||1048576;let n=0;for(;n<e.size;){const t=n+r,s=await u(e,n,t);n=t,yield s}}(e,t):(0,n.Os)(e)?h(e):(0,n.Ew)(e)?h(e.body):(0,o.Z)(!1)}var p=r(3385);const y="Cannot convert supplied data type";async function g(e,t){const r=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||r)return function(e,t){if(t.text&&"string"==typeof e)return e;if(e instanceof ArrayBuffer){const r=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(e)||(0,n.zH)(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let r=e.buffer;const n=e.byteLength||e.length;return 0===e.byteOffset&&n===r.byteLength||(r=r.slice(e.byteOffset,e.byteOffset+n)),r}throw new Error(y)}(e,t);if((0,n.Lj)(e)&&(e=await(0,p.L1)(e)),(0,n.Ew)(e)){const r=e;return await(0,p.mm)(r),t.binary?await r.arrayBuffer():await r.text()}if((0,n.Os)(e)&&(e=d(e)),(0,n.TW)(e)||(0,n.D0)(e))return async function(e){const t=[],r=[];for await(const n of e)"string"==typeof n?r.push(n):t.push(n);return r.length>0?((0,o.Z)(0===t.length),r.join("")):(0,c.JY)(...t)}(e);throw new Error(y)}const m=new Map;function b(e,t=!0,r){const n=r||new Set;if(e){if(_(e))n.add(e);else if(_(e.buffer))n.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const r in e)b(e[r],t,n)}else;return void 0===r?Array.from(n):[]}function _(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}let T=0;function w({data:e,resolve:t}){t(e)}class A{constructor({source:e,name:t="web-worker-".concat(T++),onMessage:r}){const n=function(e,t="Worker"){if((0,o.Z)("string"==typeof e,"worker source"),e.startsWith("url(")&&e.endsWith(")")){const t=e.match(/^url\((.*)\)$/)[1];if(t&&!t.startsWith("http"))return t;e=function(e){return"try {\n  importScripts('".concat(e,"');\n} catch (error) {\n  console.error(error);\n}")}(t)}let r=m.get(e);if(!r){const t=new Blob([e],{type:"application/javascript"});r=URL.createObjectURL(t),m.set(e,r)}return r}(e,t);this.worker=new Worker(n,{name:t}),this.name=t,this.onMessage=r||w}async process(e){return new Promise(((t,r)=>{this.worker.onmessage=e=>{this.onMessage({worker:this.worker,data:e.data,resolve:t,reject:r})},this.worker.onerror=e=>{let t="".concat(this.name,": WorkerThread.process() failed");e.message&&(t+=" ".concat(e.message," ").concat(e.filename,":").concat(e.lineno,":").concat(e.colno));const n=new Error(t);console.error(e),r(n)};const n=b(e);this.worker.postMessage(e,n)}))}destroy(){this.worker.terminate(),this.worker=null}}class E{constructor({source:e,name:t="unnamed",maxConcurrency:r=1,onMessage:n,onDebug:s=(()=>{}),reuseWorkers:i=!0}){this.source=e,this.name=t,this.maxConcurrency=r,this.onMessage=n,this.onDebug=s,this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.reuseWorkers=i}destroy(){this.idleQueue.forEach((e=>e.destroy())),this.isDestroyed=!0}process(e,t){return new Promise(((r,n)=>{this.jobQueue.push({data:e,jobName:t,resolve:r,reject:n}),this._startQueuedJob()}))}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();this.onDebug({message:"processing",worker:e.name,job:t.jobName,backlog:this.jobQueue.length});try{t.resolve(await e.process(t.data))}catch(e){t.reject(e)}finally{this._onWorkerDone(e)}}_onWorkerDone(e){this.isDestroyed?e.destroy():(this.reuseWorkers?this.idleQueue.push(e):(e.destroy(),this.count--),this._startQueuedJob())}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift();if(this.count<this.maxConcurrency){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new A({source:this.source,onMessage:this.onMessage,name:e})}return null}}class I{static isSupported(){return"undefined"!=typeof Worker}constructor({maxConcurrency:e=5,onMessage:t=null,onDebug:r=(()=>{}),reuseWorkers:n=!0}){this.maxConcurrency=e,this.onMessage=t,this.onDebug=r,this.workerPools=new Map,this.reuseWorkers=n}setProps(e){"maxConcurrency"in e&&(this.maxConcurrency=e.maxConcurrency),"onDebug"in e&&(this.onDebug=e.onDebug),"reuseWorkers"in e&&(this.reuseWorkers=e.reuseWorkers)}destroy(){this.workerPools.forEach((e=>e.destroy()))}async process(e,t,r){return this._getWorkerPool(e,t).process(r)}_getWorkerPool(e,t){let r=this.workerPools.get(t);return r||(r=new E({source:e,name:t,onMessage:v.bind(null,this.onMessage),maxConcurrency:this.maxConcurrency,onDebug:this.onDebug,reuseWorkers:this.reuseWorkers}),this.workerPools.set(t,r)),r}}function v(e,{worker:t,data:r,resolve:n,reject:s}){if(e)e({worker:t,data:r,resolve:n,reject:s});else switch(r.type){case"done":n(r.result);break;case"error":s(r.message)}}const x="2.3.13";function O(e,t,r,n){const{worker:s}=r||{},i=r&&r[e.id]||{},o="local"===s?i.localWorkerUrl:i.workerUrl,a="url(".concat(o,")"),u=e.name,l=function(e={}){const t={};e.maxConcurrency&&(t.maxConcurrency=e.maxConcurrency);e.onDebug&&(t.onDebug=e.onDebug);"reuseWorkers"in e&&(t.reuseWorkers=e.reuseWorkers);S||(S=new I({onMessage:P}));return S.setProps(t),S}(r);r=JSON.parse(JSON.stringify(r));const h=e.version!==x?"(core version ".concat(x,")"):"";return l.process(a,"".concat(u,"-worker@").concat(e.version).concat(h),{arraybuffer:(0,c.rJ)(t),options:r,source:"loaders.gl@".concat(x),type:"parse"})}let S=null;async function P({worker:e,data:t,resolve:r,reject:n}){switch(t.type){case"done":r(t.result);break;case"parse":try{const r=await B(t.arraybuffer,t.options,t.url);e.postMessage({type:"parse-done",id:t.id,result:r},b(r))}catch(r){e.postMessage({type:"parse-error",id:t.id,message:r.message})}break;case"error":n(t.message)}}var C=r(9291),R=r(7615);const U=/\.([^.]+)$/;function N(e,t=[],r={},n={}){if(t&&!Array.isArray(t))return(0,s.T)(t);!function(e){for(const t of e)(0,s.T)(t)}(t=[...t||[],...(0,R.kO)()]);const{url:i,type:o}=(0,C.l)(e);let a=function(e,t){const r=t&&t.match(U),n=r&&r[1];return n&&function(e,t){t=t.toLowerCase();for(const r of e)for(const e of r.extensions)if(e.toLowerCase()===t)return r;return null}(e,n)}(t,i||n.url);if(a=a||function(e,t){for(const r of e){if(r.mimeTypes&&r.mimeTypes.includes(t))return r;if(t==="application/x.".concat(r.id))return r}return null}(t,o),a=a||function(e,t){if(!t)return null;for(const r of e)if("string"==typeof t){if(L(t,r))return r}else if(ArrayBuffer.isView(t)){if(D(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer){if(D(t,0,r))return r}return null}(t,e),!a&&!r.nothrow)throw new Error(M(e));return a}function M(e){const{url:t,type:r}=(0,C.l)(e);let n="No valid loader found";return e&&(n+=' data: "'.concat(function(e,t=5){if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return V(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){return V(e,0,t)}return""}(e),'", contentType: "').concat(r,'"')),t&&(n+=" url: ".concat(t)),n}function L(e,t){return t.testText&&t.testText(e)}function D(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some((n=>function(e,t,r,n){if(n instanceof ArrayBuffer)return(0,c.Xq)(n,e,n.byteLength);switch(typeof n){case"function":return n(e,r);case"string":return n===V(e,t,n.length);default:return!1}}(e,t,r,n)))}function V(e,t,r){if(e.byteLength<t+r)return"";const n=new DataView(e);let s="";for(let e=0;e<r;e++)s+=String.fromCharCode(n.getUint8(t+e));return s}async function B(e,t,r,c){(0,o.Z)(!c||"string"!=typeof c,"parse no longer accepts final url"),!t||Array.isArray(t)||(0,s.C)(t)||(c=r,r=t,t=null),e=await e,r=r||{};const{url:l}=(0,C.l)(e),h=function(e,t){if(!t&&e&&!Array.isArray(e))return e;let r;if(e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];r=r?[...r,...e]:e}return r&&r.length?r:null}(t,c),f=await async function(e,t=[],r={},s={}){let i=N(e,t,{...r,nothrow:!0},s);if(i)return i;if((0,n.Lj)(e)&&(i=N(e=await u(e,0,10),t,r,s)),!i&&!r.nothrow)throw new Error(M(e));return i}(e,h,r);return f?(c=function(e,t,r=null){return r||(e={fetch:(0,i.bV)(t||{},e),...e},Array.isArray(e.loaders)||(e.loaders=null),e)}({url:l,parse:B,loaders:h},r=(0,i.GR)(r,f,h,l),c),await async function(e,t,r,n){if(function(e,t="2.3.13"){(0,o.Z)(e,"no loader provided");let r=e.version;t&&r&&(t=a(t),r=a(r))}(e),t=await g(t,e),e.parseTextSync&&"string"==typeof t)return r.dataType="text",e.parseTextSync(t,r,n,e);if(function(e,t,r,n){if(!I.isSupported())return!1;const s=r&&r[e.id];return!!("local"===r.worker&&s&&s.localWorkerUrl||r.worker&&s&&s.workerUrl)&&(!e.useWorker||e.useWorker(r))}(e,0,r))return await O(e,t,r);if(e.parseText&&"string"==typeof t)return await e.parseText(t,r,n,e);if(e.parse)return await e.parse(t,r,n,e);return(0,o.Z)(!e.parseSync),(0,o.Z)(!1)}(f,e,r,c)):null}async function j(e,t,r){Array.isArray(t)||(0,s.C)(t)||(r=t,t=null);const o=(0,i.bV)(r||{});let a=e;return"string"==typeof e?a=await o(e):e=null,(0,n.Lj)(e)&&(a=await o(e),e=null),await B(a,t,r)}},7615:(e,t,r)=>{"use strict";r.d(t,{fh:()=>o,kO:()=>a});var n=r(2937),s=r(1174);const i=()=>{const e=(0,s.rx)();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function o(e){const t=i();e=Array.isArray(e)?e:[e];for(const r of e){const e=(0,n.T)(r);t.find((t=>e===t))||t.unshift(e)}}function a(){return i()}},2937:(e,t,r)=>{"use strict";r.d(t,{C:()=>s,T:()=>i});var n=r(8338);function s(e){if(!e)return!1;Array.isArray(e)&&(e=e[0]);let t=e.parseTextSync||e.parseSync||e.parse||e.parseStream||e.parseInBatches;const r=e.options&&e.options[e.id];return t=t||r&&r.workerUrl,t}function i(e){let t;return(0,n.Z)(e,"null loader"),(0,n.Z)(s(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),e.extension&&(e.extensions=e.extensions||e.extension,delete e.extension),Array.isArray(e.extensions)||(e.extensions=[e.extensions]),(0,n.Z)(e.extensions&&e.extensions.length>0&&e.extensions[0]),(e.parseTextSync||e.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}},1174:(e,t,r)=>{"use strict";r.d(t,{bV:()=>y,rx:()=>f,GR:()=>p});var n=r(8774),s=r(7491);let i="";const o={};var a=r(3385);async function c(e,t={}){if("string"!=typeof e)return await(0,a.L1)(e);e=function(e){for(const t in o)if(e.startsWith(t)){const r=o[t];e=e.replace(t,r)}return e.startsWith("http://")||e.startsWith("https://")||(e="".concat(i).concat(e)),e}(e);const r=await fetch(e,t);if(!r.ok&&t.throws)throw new Error(await async function(e){let t="Failed to fetch resource ".concat(e.url," (").concat(e.status,"): ");try{e.headers.get("Content-Type").includes("application/json")?t+=await e.text():t+=e.statusText}catch(e){return t}return t}(r));return r}class u{log(){return e=>{}}info(){return e=>{}}warn(){return e=>{}}error(){return e=>{}}}const l={baseUri:"",fetch:null,CDN:"https://unpkg.com/@loaders.gl",worker:!0,log:new class{constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},metadata:!1,transforms:[],reuseWorkers:!0},h={dataType:"(no longer used)",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"},f=()=>{n.CO.loaders=n.CO.loaders||{};const{loaders:e}=n.CO;return e._state=e._state||{},e._state},d=()=>{const e=f();return e.globalOptions=e.globalOptions||{...l},e.globalOptions};function p(e,t,r,n){return r=r||[],function(e,t,r=console){g(e,null,r,l,h,t);for(const n of t){const s=e&&e[n.id]||{},i=n.options&&n.options[n.id]||{},o=n.defaultOptions&&n.defaultOptions[n.id]||{};g(s,n.id,r,i,o,t)}}(e,r=Array.isArray(r)?r:[r]),b(t,e,n)}function y(e,t){const r=d(),n=e.fetch||r.fetch;return"function"==typeof n?n:(0,s.Kn)(n)?e=>c(e,n):t&&t.fetch?t.fetch:t=>c(t,e)}function g(e,t,r,n,i,o){const a=t||"Top level",c=t?"".concat(t,"."):"";for(const u in e){const l=!t&&(0,s.Kn)(e[u]);if(!(u in n))if(u in i)r.warn("".concat(a," loader option '").concat(c).concat(u,"' deprecated, use '").concat(i[u],"'"));else if(!l){const e=m(u,o);r.warn("".concat(a," loader option '").concat(c).concat(u,"' not recognized. ").concat(e))}}}function m(e,t){const r=e.toLowerCase();let n="";for(const s of t)for(const t in s.options){if(e===t)return"Did you mean '".concat(s.id,".").concat(t,"'?");const i=t.toLowerCase();(r.startsWith(i)||i.startsWith(r))&&(n=n||"Did you mean '".concat(s.id,".").concat(t,"'?"))}return n}function b(e,t,r){const n={...e.options||{}};return null===n.log&&(n.log=new u),_(n,d()),_(n,t),function(e,t){t&&!e.baseUri&&(e.baseUri=t)}(n,r),n}function _(e,t){for(const r in t)if(r in t){const n=t[r];(0,s.Ss)(n)&&(0,s.Ss)(e[r])?e[r]={...e[r],...t[r]}:e[r]=t[r]}}},9291:(e,t,r)=>{"use strict";r.d(t,{C:()=>u,l:()=>c});var n=r(7491);const s=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,i=/^([-\w.]+\/[-\w.+]+)/;function o(e){if("string"!=typeof e)return"";const t=e.match(s);return t?t[1]:""}const a=/\?.*/;function c(e){if((0,n.Ew)(e)){const t=function(e){if("string"!=typeof e)return"";const t=e.match(i);return t?t[1]:e}(e.headers.get("content-type")),r=o(e.url);return{url:l(e.url||""),type:t||r||null}}return(0,n.Lj)(e)?{url:l(e.name||""),type:e.type||""}:"string"==typeof e?{url:l(e),type:o(e)}:{url:"",type:""}}function u(e){return(0,n.Ew)(e)?e.headers["content-length"]||-1:(0,n.Lj)(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}function l(e){return e.replace(a,"")}},3385:(e,t,r)=>{"use strict";r.d(t,{L1:()=>i,mm:()=>o});var n=r(7491),s=r(9291);async function i(e){if((0,n.Ew)(e))return e;const t={},r=(0,s.C)(e);r>=0&&(t["content-length"]=String(r));const{url:i,type:o}=(0,s.l)(e);o&&(t["content-type"]=o);const a=await async function(e){const t=5;if("string"==typeof e)return"data:,".concat(e.slice(0,t));if(e instanceof Blob){const t=e.slice(0,5);return await new Promise((e=>{const r=new FileReader;r.onload=t=>e(t.target&&t.target.result),r.readAsDataURL(t)}))}if(e instanceof ArrayBuffer){const r=function(e){let t="";const r=new Uint8Array(e);for(let e=0;e<r.byteLength;e++)t+=String.fromCharCode(r[e]);return btoa(t)}(e.slice(0,t));return"data:base64,".concat(r)}return null}(e);a&&(t["x-first-bytes"]=a),"string"==typeof e&&(e=(new TextEncoder).encode(e));const c=new Response(e,{headers:t});return Object.defineProperty(c,"url",{value:i}),c}async function o(e){if(!e.ok){const t=await async function(e){let t="Failed to fetch resource ".concat(e.url," (").concat(e.status,"): ");try{const r=e.headers.get("Content-Type");let n=e.statusText;r.includes("application/json")&&(n+=" ".concat(await e.text())),t+=n,t=t.length>60?"".concat(t.slice(60),"..."):t}catch(e){}return t}(e);throw new Error(t)}}},3353:(e,t,r)=>{"use strict";r.d(t,{V:()=>b});var n=r(8774),s=r(5440),i=r(8338);const o="2.3.13",a={};async function c(e,t=null,r={}){return t&&(e=function(e,t,r){const s=r.modules||{};if(s[e])return s[e];if(!n.jU)return"modules/".concat(t,"/dist/libs/").concat(e);if(r.CDN)return(0,i.Z)(r.CDN.startsWith("http")),"".concat(r.CDN,"/").concat(t,"@").concat(o,"/dist/libs/").concat(e);if(n.hJ)return"../src/libs/".concat(e);return"modules/".concat(t,"/src/libs/").concat(e)}(e,t,r)),a[e]=a[e]||async function(e){if(e.endsWith("wasm")){const t=await fetch(e);return await t.arrayBuffer()}if(!n.jU)return s.requireFromFile&&s.requireFromFile(e);if(n.hJ)return importScripts(e);const t=await fetch(e);return function(e,t){if(!n.jU)return s.requireFromString&&s.requireFromString(e,t);if(n.hJ)return eval.call(n.CO,e),null;const r=document.createElement("script");r.id=t;try{r.appendChild(document.createTextNode(e))}catch(t){r.text=e}return document.body.appendChild(r),null}(await t.text(),e)}(e),await a[e]}let u;async function l(e){const t=e.modules||{};return u=t.draco3d?u||new Promise((e=>{const r=t.draco3d.createDecoderModule({onModuleLoaded(){e({draco:r})}})})):u||async function(e){let t,r;switch(e.draco&&e.draco.decoderType){case"js":t=await c("draco_decoder.js","draco",e);break;case"wasm":default:[t,r]=await Promise.all([await c("draco_wasm_wrapper.js","draco",e),await c("draco_decoder.wasm","draco",e)])}return t=t||n.CO.DracoDecoderModule,await function(e,t){const r={};t&&(r.wasmBinary=t);return new Promise((t=>{e({...r,onModuleLoaded:e=>t({draco:e})})}))}(t,r)}(e),await u}var h=r(4449);const f=0,d=1,p={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},y={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class g{constructor(e){this.draco=e,this.drawMode="TRIANGLE",this.metadataQuerier={}}destroy(){}destroyGeometry(e){e&&this.draco.destroy(e.dracoGeometry)}parseSync(e,t={}){this.metadataQuerier=new this.draco.MetadataQuerier;const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength);const n=new this.draco.Decoder,s={};let i,o,a;try{const e=n.GetEncodedGeometryType(r);switch(e){case this.draco.TRIANGULAR_MESH:o=new this.draco.Mesh,i=n.DecodeBufferToMesh(r,o),a={type:f,faceCount:o.num_faces(),attributeCount:o.num_attributes(),vertexCount:o.num_points()};break;case this.draco.POINT_CLOUD:o=new this.draco.PointCloud,i=n.DecodeBufferToPointCloud(r,o),a={type:d,attributeCount:o.num_attributes(),vertexCount:o.num_points()};break;default:throw new Error("Unknown DRACO geometry type.")}if(!i.ok()||!o.ptr){const e="DRACO decompression failed: ".concat(i.error_msg());throw o&&this.draco.destroy(o),new Error(e)}s.loaderData={header:a},this._extractDRACOGeometry(n,o,e,s,t);const c=this._getGeometryMetadata(n,o);s.header={vertexCount:a.vertexCount,boundingBox:(0,h.v)(s.attributes),metadata:c}}finally{this.draco.destroy(n),this.draco.destroy(r),this.draco.destroy(o),this.draco.destroy(this.metadataQuerier)}return s}_extractDRACOGeometry(e,t,r,n,s){const i=this._getAttributes(e,t,s);if(!i.POSITION)throw new Error("DRACO decompressor: No position attribute found.");return r===this.draco.TRIANGULAR_MESH?(i.indices="TRIANGLE_STRIP"===this.drawMode?this._getMeshStripIndices(e,t):this._getMeshFaceIndices(e,t),n.mode="TRIANGLE_STRIP"===this.drawMode?5:4):n.mode=0,i.indices&&(n.indices={value:i.indices,size:1},delete i.indices),n.attributes=i,n}getPositionAttributeMetadata(e){this.metadata=this.metadata||{},this.metadata.attributes=this.metadata.attributes||{};const t=new this.draco.AttributeQuantizationTransform;if(t.InitFromAttribute(e)){this.metadata.attributes.position.isQuantized=!0,this.metadata.attributes.position.maxRange=t.range(),this.metadata.attributes.position.numQuantizationBits=t.quantization_bits(),this.metadata.attributes.position.minValues=new Float32Array(3);for(let e=0;e<3;++e)this.metadata.attributes.position.minValues[e]=t.min_value(e)}this.draco.destroy(t)}_getAttributes(e,t,r){const n={},s=t.num_points();for(let i=0;i<t.num_attributes();i++){const o=e.GetAttribute(t,i),a=this._getAttributeMetadata(e,t,i),c={uniqueId:o.unique_id(),attributeType:o.attribute_type(),dataType:y[o.data_type()],size:o.size(),numComponents:o.num_components(),byteOffset:o.byte_offset(),byteStride:o.byte_stride(),normalized:o.normalized(),metadata:a},u=this._deduceAttributeName(c,r),{typedArray:l}=this._getAttributeTypedArray(e,t,o,u);n[u]={value:l,size:l.length/s,metadata:a}}return n}_getMeshFaceIndices(e,t){const r=t.num_faces(),n=new Uint32Array(3*r),s=new this.draco.DracoInt32Array;for(let i=0;i<r;++i){e.GetFaceFromMesh(t,i,s);const r=3*i;n[r]=s.GetValue(0),n[r+1]=s.GetValue(1),n[r+2]=s.GetValue(2)}return this.draco.destroy(s),n}_getMeshStripIndices(e,t){const r=new this.draco.DracoInt32Array;e.GetTriangleStripsFromMesh(t,r);const n=new Uint32Array(r.size());for(let e=0;e<r.size();++e)n[e]=r.GetValue(e);return this.draco.destroy(r),n}_getAttributeTypedArray(e,t,r,n){if(0===r.ptr){const e="DRACO decode bad attribute ".concat(n);throw new Error(e)}const s=y[r.data_type()],i=r.num_components(),o=t.num_points()*i;let a,c;switch(s){case Float32Array:a=new this.draco.DracoFloat32Array,e.GetAttributeFloatForAllPoints(t,r,a),c=new Float32Array(o);break;case Int8Array:a=new this.draco.DracoInt8Array,e.GetAttributeInt8ForAllPoints(t,r,a),c=new Int8Array(o);break;case Int16Array:a=new this.draco.DracoInt16Array,e.GetAttributeInt16ForAllPoints(t,r,a),c=new Int16Array(o);break;case Int32Array:a=new this.draco.DracoInt32Array,e.GetAttributeInt32ForAllPoints(t,r,a),c=new Int32Array(o);break;case Uint8Array:a=new this.draco.DracoUInt8Array,e.GetAttributeUInt8ForAllPoints(t,r,a),c=new Uint8Array(o);break;case Uint16Array:a=new this.draco.DracoUInt16Array,e.GetAttributeUInt16ForAllPoints(t,r,a),c=new Uint16Array(o);break;case Uint32Array:a=new this.draco.DracoUInt32Array,e.GetAttributeUInt32ForAllPoints(t,r,a),c=new Uint32Array(o);break;default:throw new Error("DRACO decoder: unexpected attribute type.")}for(let e=0;e<o;e++)c[e]=a.GetValue(e);return this.draco.destroy(a),{typedArray:c,components:i}}_deduceAttributeName(e,t){const{extraAttributes:r={}}=t;if(r&&"object"==typeof r)for(const[t,n]of Object.entries(r))if(n===e.uniqueId)return t;for(const t in p){const r=this.draco[t];if(e.attributeType===r)return p[t]}if(e.metadata){const r=t.attributeNameEntry||"name";if(e.metadata[r])return e.metadata[r].string}return"CUSTOM_ATTRIBUTE_".concat(e.uniqueId)}_getGeometryMetadata(e,t){const r=e.GetMetadata(t);return this._queryDracoMetadata(r)}_getAttributeMetadata(e,t,r){const n=e.GetAttributeMetadata(t,r);return this._queryDracoMetadata(n)}_queryDracoMetadata(e){if(!e||!e.ptr)return{};const t={},r=this.metadataQuerier.NumEntries(e);for(let n=0;n<r;n++){const r=this.metadataQuerier.GetEntryName(e,n);t[r]={int:this.metadataQuerier.GetIntEntry(e,r),string:this.metadataQuerier.GetStringEntry(e,r),double:this.metadataQuerier.GetDoubleEntry(e,r),intArray:this.metadataQuerier.GetIntEntryArray(e,r)}}return t}decode(e,t){return this.parseSync(e,t)}}const m="2.3.13",b={...{id:"draco",name:"Draco",version:m,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",workerUrl:"https://unpkg.com/@loaders.gl/draco@".concat(m,"/dist/draco-loader.worker.js"),localWorkerUrl:"modules/draco/dist/draco-loader.worker.dev.js",extraAttributes:{}}}},parse:async function(e,t,r,n){const{draco:s}=await l(t),i=new g(s);try{return i.parseSync(e,{extraAttributes:t.draco&&t.draco.extraAttributes||null,...t.parseOptions||{}})}finally{i.destroy()}}}},2607:(e,t,r)=>{"use strict";function n(e,t,r){if("geometry"===r)return i(e);const n=function(e,t){if(!Boolean(e.points||e.lines||e.polygons))return e.type=t||function(e){if(e.pathIndices)return"LineString";if(e.polygonIndices)return"Polygon";return"Point"}(e),[e];const r=[];e.points&&(e.points.type="Point",r.push(e.points));e.lines&&(e.lines.type="LineString",r.push(e.lines));e.polygons&&(e.polygons.type="Polygon",r.push(e.polygons));return r}(e,t);switch(function(e){if(e.length>1)return"FeatureCollection";const t=e[0];if(!(t.featureIds||t.globalFeatureIds||t.numericProps||t.properties))return"Geometry";return"FeatureCollection"}(n)){case"Geometry":return i(n[0]);case"FeatureCollection":return function(e){const t=[];for(const r of e){if(0===r.featureIds.value.length)continue;let e=0,n=r.featureIds.value[0];for(let i=0;i<r.featureIds.value.length;i++){const o=r.featureIds.value[i];o!==n&&(t.push(s(r,e,i)),e=i,n=o)}t.push(s(r,e,r.featureIds.value.length))}return t}(n)}return null}function s(e,t,r){return{type:"Feature",geometry:i(e,t,r),properties:function(e,t,r){const n=Object.assign(e.properties[e.featureIds.value[t]]);for(const r in e.numericProps)n[r]=e.numericProps[r].value[t];return n}(e,t)}}function i(e,t,r){switch(e.type){case"Point":return function(e,t,r){const{positions:n}=e,s=a(n,t,r);if(s.length>1)return{type:"MultiPoint",coordinates:s};return{type:"Point",coordinates:s[0]}}(e,t,r);case"LineString":return function(e,t=-1/0,r=1/0){const{positions:n}=e,s=e.pathIndices.value.filter((e=>e>=t&&e<=r));if(!(s.length>2)){return{type:"LineString",coordinates:a(n,s[0],s[1])}}const i=[];for(let e=0;e<s.length-1;e++){const t=a(n,s[e],s[e+1]);i.push(t)}return{type:"MultiLineString",coordinates:i}}(e,t,r);case"Polygon":return o(e,t,r);default:throw new Error("Unsupported geometry type: ".concat(e.type))}}function o(e,t=-1/0,r=1/0){const{positions:n}=e,s=e.polygonIndices.value.filter((e=>e>=t&&e<=r)),i=e.primitivePolygonIndices.value.filter((e=>e>=t&&e<=r)),c=[];if(!(s.length>2)){for(let e=0;e<i.length-1;e++){const t=a(n,i[e],i[e+1]);c.push(t)}return{type:"Polygon",coordinates:c}}for(let t=0;t<s.length-1;t++){const r=o(e,s[t],s[t+1]).coordinates;c.push(r)}return{type:"MultiPolygon",coordinates:c}}function a(e,t,r){t=t||0,r=r||e.value.length/e.size;const n=[];for(let s=t;s<r;s++)n.push(Array.from(e.value.subarray(s*e.size,(s+1)*e.size)));return n}r.d(t,{c:()=>n})},4801:(e,t,r)=>{"use strict";r.d(t,{Z:()=>ue});var n={};r.r(n),r.d(n,{decode:()=>R,encode:()=>U});var s={};r.r(s),r.d(s,{decode:()=>L,encode:()=>D});var i={};r.r(i),r.d(i,{decode:()=>V,encode:()=>B});var o={};r.r(o),r.d(o,{decode:()=>j,encode:()=>k});var a=r(7937);function c(e,t,r){if(e.byteLength<=t+r)return"";const n=new DataView(e);let s="";for(let e=0;e<r;e++)s+=String.fromCharCode(n.getUint8(t+e));return s}function u(e){try{return JSON.parse(e)}catch(t){throw new Error('Failed to parse JSON from data starting with "'.concat(function(e,t=5){if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return c(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer)return c(e,0,t);return""}(e),'"'))}}var l=r(1270);function h(e,t){if(!e)throw new Error(t||"assert failed: gltf")}function f(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const r=t.baseUri||t.uri;if(!r)throw new Error("'baseUri' must be provided to resolve relative url ".concat(e));return r.substr(0,r.lastIndexOf("/")+1)+e}function d(e,t,r){const n=e.bufferViews[r];h(n);const s=t[n.buffer];h(s);const i=(n.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,i,n.byteLength)}var p=r(3353),y=r(3242);const g=["SCALAR","VEC2","VEC3","VEC4"],m=new Map([[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126]]),b={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},T={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function w(e){return g[e-1]||g[0]}function A(e){const t=m.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function E(e,t){const r=T[e.componentType],n=b[e.type],s=_[e.componentType],i=e.count*n,o=e.count*n*s;return h(o>=0&&o<=t.byteLength),{ArrayType:r,length:i,byteLength:o}}class I{constructor(e){if(e instanceof I)return e;e||(e={json:{asset:{version:"2.0",generator:"loaders.gl"},buffers:[]},buffers:[]}),this.byteLength=0,this.gltf=e,h(this.gltf.json)}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const t=this.getUsedExtensions().find((t=>t===e)),r=this.json.extensions||{};return t?r[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find((t=>t===e))?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getCamera(e){return null}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if("object"==typeof t)return t;const r=this.json[e]&&this.json[e][t];if(!r)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(t,"]"));return r}getTypedArrayForBufferView(e){const t=(e=this.getBufferView(e)).buffer,r=this.gltf.buffers[t];h(r);const n=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,n,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),r=this.getBuffer(t.buffer).data,{ArrayType:n,length:s}=E(e,t);return new n(r,t.byteOffset+e.byteOffset,s)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),r=this.getBuffer(t.buffer).data,n=t.byteOffset||0;return new Uint8Array(r,n,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,r){return h(r),e.extensions=e.extensions||{},e.extensions[t]=r,this.registerUsedExtension(t),this}setObjectExtension(e,t,r){(e.extensions||{})[t]=r}removeObjectExtension(e,t){const r=e.extensions||{},n=r[t];return delete r[t],n}addExtension(e,t={}){return h(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return h(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((t=>t===e))||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((t=>t===e))||this.json.extensionsRequired.push(e)}removeExtension(e){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e]}addMesh(e,t,r=4){const n={primitives:[{attributes:this._addAttributes(e),indices:t,mode:r}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addPointCloud(e){const t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}addImage(e,t){t=t||function(e){const t=(0,y.I)(e);return t?t.mimeType:null}(e);const r={bufferView:this.addBufferView(e),mimeType:t};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}addBufferView(e){const t=e.byteLength;h(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const r={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=(0,l.XJ)(t),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(e,t){const r={bufferView:e,type:w(t.size),componentType:t.componentType,count:t.count};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const r=this.addBufferView(e),n={size:t.size,componentType:A(e),count:Math.round(e.length/t.size)};return this.addAccessor(r,Object.assign(n,t))}createBinaryChunk(){if(this.arrayBuffer)return;const e=this.byteLength,t=new ArrayBuffer(e),r=new Uint8Array(t);let n=0;for(let e=0;e<this.sourceBuffers.length;e++){const t=this.sourceBuffers[e];n=(0,l.T_)(t,r,n)}this.json.buffers[0].byteLength=e,this.arrayBuffer=t,this.sourceBuffers=[]}_removeStringFromArray(e,t){let r=!0;for(;r;){const n=e.indexOf(t);n>-1?e.splice(n,1):r=!1}}}const v="KHR_binary_glTF",x="KHR_draco_mesh_compression",O="KHR_lights_punctual",S="KHR_materials_unlit",P="KHR_techniques_webgl";function C(e,t={}){const{buffer:r,size:n,count:s}=function(e){let t=e,r=1,n=0;e&&e.value&&(t=e.value,r=e.size||1);t&&(ArrayBuffer.isView(t)||(t=function(e,t,r=!1){if(!e)return null;if(Array.isArray(e))return new t(e);if(r&&!(e instanceof t))return new t(e);return e}(t,Float32Array)),n=t.length/r);return{buffer:t,size:r,count:n}}(e);return{...t,value:r,size:n,bufferView:null,byteOffset:0,count:s,type:w(n),componentType:A(r)}}async function R(e,t,r){if(!t.gltf.decompressMeshes)return;const n=new I(e),s=[];for(const e of function*(e){for(const t of e.json.meshes||[])for(const e of t.primitives)yield e}(n))n.getObjectExtension(e,x)&&s.push(N(e,n,t,r));await Promise.all(s),n.removeExtension(x)}function U(e,t={}){const r=new I(e);for(const e of r.json.meshes||[])M(e,t),r.addRequiredExtension(x)}async function N(e,t,r,n){const s=t.getObjectExtension(e,x),i=t.getTypedArrayForBufferView(s.bufferView),o=(0,l.Aj)(i.buffer,i.byteOffset),{parse:a}=n,c={...r};delete c["3d-tiles"];const u=await a(o,p.V,c,n),h={};for(const[r,n]of[...Object.entries(e.attributes),["indices",e.indices]])h[r]=t.getAccessor(n);e.attributes=function(e,t={}){const r={};for(const n in e){const s=e[n];if("indices"!==n){const e=C(s,t[n]||{});r[n]=e}}return r}(u.attributes,h),u.indices&&(e.indices=C(u.indices,h.indices||{})),function(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("Empty glTF primitive detected: Draco decompression failure?")}(e)}function M(e,t,r=4,n,s){if(!n.DracoWriter||!n.DracoLoader)throw new Error("DracoWriter/DracoLoader not available");const i=n.DracoWriter.encodeSync({attributes:e}),{parseSync:o}=s,a=o({attributes:e}),c=n._addFauxAttributes(a.attributes),u=n.addBufferView(i);return{primitives:[{attributes:c,mode:r,extensions:{[x]:{bufferView:u,attributes:c}}}]}}function L(e,t){const r=new I(e),{json:n}=r,s=r.getExtension(O);s&&(r.json.lights=s.lights,r.removeExtension(O));for(const e of n.nodes||[]){const t=r.getObjectExtension(e,O);t&&(e.light=t.light),r.removeObjectExtension(e,O)}}function D(e,t){const r=new I(e),{json:n}=r;if(n.lights){const e=r.addExtension(O);h(!e.lights),e.lights=n.lights,delete n.lights}if(r.json.lights){for(const e of r.json.lights){const t=e.node;r.addObjectExtension(t,O,e)}delete r.json.lights}}function V(e,t){const r=new I(e),{json:n}=r;r.removeExtension(S);for(const e of n.materials||[]){e.extensions&&e.extensions.KHR_materials_unlit&&(e.unlit=!0),r.removeObjectExtension(e,S)}}function B(e,t){const r=new I(e),{json:n}=r;if(r.materials)for(const e of n.materials)e.unlit&&(delete e.unlit,r.addObjectExtension(e,S,{}),r.addExtension(S))}function j(e,t){const r=new I(e),{json:n}=r,s=r.getExtension(P);if(s){const e=function({programs:e=[],shaders:t=[],techniques:r=[]},n){const s=new TextDecoder;return t.forEach((e=>{if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=s.decode(n.getTypedArrayForBufferView(e.bufferView))})),e.forEach((e=>{e.fragmentShader=t[e.fragmentShader],e.vertexShader=t[e.vertexShader]})),r.forEach((t=>{t.program=e[t.program]})),r}(s,r);for(const t of n.materials||[]){const n=r.getObjectExtension(t,P);n&&(t.technique=Object.assign({},n,e[n.technique]),t.technique.values=F(t.technique,r)),r.removeObjectExtension(t,P)}r.removeExtension(P)}}function k(e,t){}function F(e,t){const r=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach((t=>{e.uniforms[t].value&&!(t in r)&&(r[t]=e.uniforms[t].value)})),Object.keys(r).forEach((e=>{"object"==typeof r[e]&&void 0!==r[e].index&&(r[e].texture=t.getTexture(r[e].index))})),r}const G={KHR_draco_mesh_compression:n,KHR_lights_punctual:s,KHR_materials_unlit:i,KHR_techniques_webgl:o};var q=r(8338);const z=1735152710,Z=1313821514,H=5130562,W=!0;function Q(e,t,r=0,n={}){const s=new DataView(t);e.type=function(e,t=0){return"".concat(String.fromCharCode(e.getUint8(t+0))).concat(String.fromCharCode(e.getUint8(t+1))).concat(String.fromCharCode(e.getUint8(t+2))).concat(String.fromCharCode(e.getUint8(t+3)))}(s,r+0),e.version=s.getUint32(r+4,W);const i=s.getUint32(r+8,W);switch(e.header={byteOffset:r,byteLength:i},e.json={},e.binChunks=[],r+=12,e.version){case 1:return function(e,t,r,n){(0,q.Z)(e.header.byteLength>20);const s=t.getUint32(r+0,W),i=t.getUint32(r+4,W);return r+=8,(0,q.Z)(0===i),J(e,t,r,s,n),r+=s,r+=Y(e,t,r,e.header.byteLength,n)}(e,s,r,{});case 2:return function(e,t,r,n){return(0,q.Z)(e.header.byteLength>20),function(e,t,r,n){for(;r+8<=e.header.byteLength;){const s=t.getUint32(r+0,W),i=t.getUint32(r+4,W);switch(r+=8,i){case Z:J(e,t,r,s,n);break;case H:Y(e,t,r,s,n);break;case 0:n.glb.strict||J(e,t,r,s,n);break;case 1:n.glb.strict||Y(e,t,r,s,n)}r+=(0,l.XJ)(s)}}(e,t,r,n),r+e.header.byteLength}(e,s,r,{});default:throw new Error("Invalid GLB version ".concat(e.version,". Only supports v1 and v2."))}}function J(e,t,r,n,s){const i=new Uint8Array(t.buffer,r,n),o=new TextDecoder("utf8").decode(i);return e.json=JSON.parse(o),(0,l.XJ)(n)}function Y(e,t,r,n,s){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:r,byteLength:n,arrayBuffer:t.buffer}),(0,l.XJ)(n)}const X={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},K={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class ${constructor(e){this.idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}}normalize(e,t){this.json=e.json;const r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return void console.warn("glTF: Unknown version ".concat(r.asset.version))}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),function(e,t){const r=new I(e),{json:n}=r;for(const e of n.images||[]){const t=r.removeObjectExtension(e,v);t&&Object.assign(e,t)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,r.removeExtension(v)}(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in X)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const r=e[t];if(r&&!Array.isArray(r)){e[t]=[];for(const n in r){const s=r[n];s.id=s.id||n;const i=e[t].length;e[t].push(s),this.idToIndexMap[t][n]=i}}}_convertObjectIdsToArrayIndices(e){for(const t in X)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:e,indices:r,material:n}=t;for(const t in e)e[t]=this._convertIdToIndex(e[t],"accessor");r&&(t.indices=this._convertIdToIndex(r,"accessor")),n&&(t.material=this._convertIdToIndex(n,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map((e=>this._convertIdToIndex(e,"node"))))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map((e=>this._convertIdToIndex(e,"node"))))}_convertIdsToIndices(e,t){for(const r of e[t])for(const e in r){const t=r[e],n=this._convertIdToIndex(t,e);r[e]=n}}_convertIdToIndex(e,t){const r=K[t];if(r in this.idToIndexMap){const n=this.idToIndexMap[r][e];if(!Number.isFinite(n))throw new Error("gltf v1: failed to resolve ".concat(t," with id ").concat(e));return n}return e}_updateObjects(e){for(const e of this.json.buffers)delete e.type}}const ee={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},te={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},re={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},ne={magFilter:re.TEXTURE_MAG_FILTER,minFilter:re.TEXTURE_MIN_FILTER,wrapS:re.TEXTURE_WRAP_S,wrapT:re.TEXTURE_WRAP_T},se={[re.TEXTURE_MAG_FILTER]:re.LINEAR,[re.TEXTURE_MIN_FILTER]:re.NEAREST_MIPMAP_LINEAR,[re.TEXTURE_WRAP_S]:re.REPEAT,[re.TEXTURE_WRAP_]:re.REPEAT};class ie{postProcess(e,t={}){const{json:r,buffers:n=[],images:s=[],baseUri:i=""}=e;return h(r),this.baseUri=i,this.json=r,this.buffers=n,this.images=s,this._resolveTree(this.json,t),this.json}_resolveTree(e,t={}){e.bufferViews&&(e.bufferViews=e.bufferViews.map(((e,t)=>this._resolveBufferView(e,t)))),e.images&&(e.images=e.images.map(((e,t)=>this._resolveImage(e,t)))),e.samplers&&(e.samplers=e.samplers.map(((e,t)=>this._resolveSampler(e,t)))),e.textures&&(e.textures=e.textures.map(((e,t)=>this._resolveTexture(e,t)))),e.accessors&&(e.accessors=e.accessors.map(((e,t)=>this._resolveAccessor(e,t)))),e.materials&&(e.materials=e.materials.map(((e,t)=>this._resolveMaterial(e,t)))),e.meshes&&(e.meshes=e.meshes.map(((e,t)=>this._resolveMesh(e,t)))),e.nodes&&(e.nodes=e.nodes.map(((e,t)=>this._resolveNode(e,t)))),e.skins&&(e.skins=e.skins.map(((e,t)=>this._resolveSkin(e,t)))),e.scenes&&(e.scenes=e.scenes.map(((e,t)=>this._resolveScene(e,t)))),void 0!==e.scene&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,t){if("object"==typeof t)return t;const r=this.json[e]&&this.json[e][t];return r||console.warn("glTF file error: Could not find ".concat(e,"[").concat(t,"]")),r}_resolveScene(e,t){return e.id=e.id||"scene-".concat(t),e.nodes=(e.nodes||[]).map((e=>this.getNode(e))),e}_resolveNode(e,t){return e.id=e.id||"node-".concat(t),e.children&&(e.children=e.children.map((e=>this.getNode(e)))),void 0!==e.mesh&&(e.mesh=this.getMesh(e.mesh)),void 0!==e.camera&&(e.camera=this.getCamera(e.camera)),void 0!==e.skin&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,t){return e.id=e.id||"skin-".concat(t),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,t){return e.id=e.id||"mesh-".concat(t),e.primitives&&(e.primitives=e.primitives.map((e=>{const t=(e={...e}).attributes;e.attributes={};for(const r in t)e.attributes[r]=this.getAccessor(t[r]);return void 0!==e.indices&&(e.indices=this.getAccessor(e.indices)),void 0!==e.material&&(e.material=this.getMaterial(e.material)),e}))),e}_resolveMaterial(e,t){if(e.id=e.id||"material-".concat(t),e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const t=e.pbrMetallicRoughness;t.baseColorTexture&&(t.baseColorTexture={...t.baseColorTexture},t.baseColorTexture.texture=this.getTexture(t.baseColorTexture.index)),t.metallicRoughnessTexture&&(t.metallicRoughnessTexture={...t.metallicRoughnessTexture},t.metallicRoughnessTexture.texture=this.getTexture(t.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,t){var r,n;if(e.id=e.id||"accessor-".concat(t),void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=(r=e.componentType,te[r]),e.components=(n=e.type,ee[n]),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const t=e.bufferView.buffer,{ArrayType:r,length:n}=E(e,e.bufferView),s=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+t.byteOffset;e.value=new r(t.arrayBuffer,s,n)}return e}_resolveTexture(e,t){return e.id=e.id||"texture-".concat(t),e.sampler="sampler"in e?this.getSampler(e.sampler):se,e.source=this.getImage(e.source),e}_resolveSampler(e,t){e.id=e.id||"sampler-".concat(t),e.parameters={};for(const t in e){const r=this._enumSamplerParameter(t);void 0!==r&&(e.parameters[r]=e[t])}return e}_enumSamplerParameter(e){return ne[e]}_resolveImage(e,t){e.id=e.id||"image-".concat(t),void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView));const r=this.images[t];return r&&(e.image=r),e}_resolveBufferView(e,t){e.id=e.id||"bufferView-".concat(t);const r=e.buffer;e.buffer=this.buffers[r];const n=this.buffers[r].arrayBuffer;let s=this.buffers[r].byteOffset||0;return"byteOffset"in e&&(s+=e.byteOffset),e.data=new Uint8Array(n,s,e.byteLength),e}_resolveCamera(e,t){return e.id=e.id||"camera-".concat(t),e.perspective,e.orthographic,e}}async function oe(e,t,r=0,n,s){!function(e,t,r,n){n.uri&&(e.baseUri=n.uri);if(t instanceof ArrayBuffer&&!function(e,t=0,r={}){const n=new DataView(e),{magic:s=z}=r,i=n.getUint32(t,!1);return i===s||i===z}(t,r,n)){t=(new TextDecoder).decode(t)}if("string"==typeof t)e.json=u(t);else if(t instanceof ArrayBuffer){const s={};r=Q(s,t,r,n),h("glTF"===s.type,"Invalid GLB magic string ".concat(s.type)),e._glb=s,e.json=s.json}else h(!1,"GLTF: must be ArrayBuffer or string");const s=e.json.buffers||[];if(e.buffers=new Array(s.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:t}=e._glb;e.buffers[0]={arrayBuffer:t[0].arrayBuffer,byteOffset:t[0].byteOffset,byteLength:t[0].byteLength}}const i=e.json.images||[];e.images=new Array(i.length).fill({})}(e,t,r,n),function(e,t={}){(new $).normalize(e,t)}(e,{normalize:n.gltf.normalize});const i=[];if(n.gltf.loadBuffers&&e.json.buffers&&await async function(e,t,r){for(let n=0;n<e.json.buffers.length;++n){const s=e.json.buffers[n];if(s.uri){const{fetch:i}=r;h(i);const o=f(s.uri,t),a=await i(o),c=await a.arrayBuffer();e.buffers[n]={arrayBuffer:c,byteOffset:0,byteLength:c.byteLength},delete s.uri}}}(e,n,s),n.gltf.loadImages){const t=async function(e,t,r){const n=e.json.images||[],s=[];for(let i=0;i<n.length;++i)s.push(ae(e,n[i],i,t,r));return await Promise.all(s)}(e,n,s);i.push(t)}const o=async function(e,t={},r){t.gltf=t.gltf||{};for(const n in G){const s=t.gltf.excludeExtensions||{};if(!(n in s)||s[n]){const s=G[n];await s.decode(e,t,r)}}}(e,n,s);return i.push(o),await Promise.all(i),n.gltf.postProcess?function(e,t){return(new ie).postProcess(e,t)}(e,n):e}async function ae(e,t,r,n,s){const{fetch:i,parse:o}=s;let c;if(t.uri){const e=f(t.uri,n),r=await i(e);c=await r.arrayBuffer()}if(Number.isFinite(t.bufferView)){const r=d(e.json,e.buffers,t.bufferView);c=(0,l.Aj)(r.buffer,r.byteOffset,r.byteLength)}h(c,"glTF image has no data");const u=await o(c,a.Z,{},s);e.images[r]=u}const ce={id:"gltf",name:"glTF",version:"2.3.13",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:async function(e,t={},r){(t={...ce.options,...t}).gltf={...ce.options.gltf,...t.gltf},function(e){"fetchImages"in e&&(e.gltf.loadImages=e.fetchImages);"createImages"in e&&(e.gltf.loadImages=e.createImages);"fetchLinkedResources"in e&&(e.gltf.fetchBuffers=e.fetchLinkedResources);"decompress"in e&&(e.gltf.decompressMeshes=e.decompress);"decompress"in e.gltf&&(e.gltf.decompressMeshes=e.gltf.decompress);"postProcess"in e&&(e.gltf.postProcess=e.postProcess)}(t);const{byteOffset:n=0}=t;return await oe({},e,n,t,r)},options:{gltf:{normalize:!1,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},baseUri:"",log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}},ue=ce},7937:(e,t,r)=>{"use strict";function n(e,t){if(!e)throw new Error(t)}r.d(t,{Z:()=>I});const s={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==r.g&&r.g,document:"undefined"!=typeof document&&document},i=s.global||s.self||s.window,o="object"!=typeof process||"[object process]"!==String(process)||process.browser,a="undefined"!=typeof process&&process.version&&process.version.match(/v([0-9]*)/),{_parseImageNode:c}=(a&&parseFloat(a[1]),i),u="undefined"!=typeof Image,l="undefined"!=typeof ImageBitmap,h=Boolean(c),f=!!o||h;function d(e){const t=p(e);if(!t)throw new Error("Not an image");return t}function p(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"==typeof e&&e.data&&e.width&&e.height?"data":null}const y=/^data:image\/svg\+xml/,g=/\.svg((\?|#).*)?$/;function m(e){return e&&(y.test(e)||g.test(e))}function b(e,t){if(m(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function _(e,t,r){const n=function(e,t){if(m(t)){const t=(new TextDecoder).decode(e);return"data:image/svg+xml;base64,".concat(btoa(t))}return b(e,t)}(e,r),s=self.URL||self.webkitURL,i="string"!=typeof n&&s.createObjectURL(n);try{return await async function(e,t){const r=new Image;if(r.src=e,t.image&&t.image.decode&&r.decode)return await r.decode(),r;return await new Promise(((t,n)=>{try{r.onload=()=>t(r),r.onerror=t=>n(new Error("Could not load image ".concat(e,": ").concat(t)))}catch(e){n(e)}}))}(i||n,t)}finally{i&&s.revokeObjectURL(i)}}const T={};let w=!0;async function A(e,t,r){let n;if(m(r)){n=await _(e,t,r)}else n=b(e,r);const s=t&&t.imagebitmap;return await async function(e,t=null){!function(e){for(const t in e||T)return!1;return!0}(t)&&w||(t=null);if(t)try{return await createImageBitmap(e,t)}catch(e){console.warn(e),w=!1}return await createImageBitmap(e)}(n,s)}var E=r(3242);const I={id:"image",name:"Images",version:"2.3.13",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:async function(e,t,r){const s=((t=t||{}).image||{}).type||"auto",{url:o}=r||{};let a;switch(function(e){switch(e){case"auto":case"data":return function(){if(l)return"imagebitmap";if(u)return"image";if(f)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return l||u||f;case"imagebitmap":return l;case"image":return u;case"data":return f;case"html":return u;case"ndarray":return f;default:throw new Error("@loaders.gl/images: image ".concat(e," not supported in this environment"))}}(e),e}}(s)){case"imagebitmap":a=await A(e,t,o);break;case"image":a=await _(e,t,o);break;case"data":a=await function(e,t){const{mimeType:r}=(0,E.I)(e)||{},{_parseImageNode:s}=i;return n(s),s(e,r,t)}(e,t);break;default:n(!1)}return"data"===s&&(a=function(e){switch(d(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),r=t.getContext("2d");if(r)return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:return n(!1)}}(a)),a},tests:[e=>Boolean((0,E.I)(new DataView(e)))],options:{image:{type:"auto",decode:!0}}}},3242:(e,t,r)=>{"use strict";r.d(t,{I:()=>i});const n=!1,s=!0;function i(e){const t=o(e);return function(e){const t=o(e);if(!(t.byteLength>=24&&2303741511===t.getUint32(0,n)))return null;return{mimeType:"image/png",width:t.getUint32(16,n),height:t.getUint32(20,n)}}(t)||function(e){const t=o(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,n)&&255===t.getUint8(2)))return null;const{tableMarkers:r,sofMarkers:s}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);const t=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:e,sofMarkers:t}}();let i=2;for(;i+9<t.byteLength;){const e=t.getUint16(i,n);if(s.has(e))return{mimeType:"image/jpeg",height:t.getUint16(i+5,n),width:t.getUint16(i+7,n)};if(!r.has(e))return null;i+=2,i+=t.getUint16(i,n)}return null}(t)||function(e){const t=o(e);if(!(t.byteLength>=10&&1195984440===t.getUint32(0,n)))return null;return{mimeType:"image/gif",width:t.getUint16(6,s),height:t.getUint16(8,s)}}(t)||function(e){const t=o(e);if(!(t.byteLength>=14&&16973===t.getUint16(0,n)&&t.getUint32(2,s)===t.byteLength))return null;return{mimeType:"image/bmp",width:t.getUint32(18,s),height:t.getUint32(22,s)}}(t)}function o(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}},4449:(e,t,r)=>{"use strict";function n(e){if(!e||!e.POSITION)return null;let t=1/0,r=1/0,n=1/0,s=-1/0,i=-1/0,o=-1/0;const a=e.POSITION.value,c=a&&a.length;if(!c)return null;for(let e=0;e<c;e+=3){const c=a[e],u=a[e+1],l=a[e+2];t=c<t?c:t,r=u<r?u:r,n=l<n?l:n,s=c>s?c:s,i=u>i?u:i,o=l>o?l:o}return[[t,r,n],[s,i,o]]}r.d(t,{v:()=>n})},2631:(e,t,r)=>{"use strict";r.d(t,{rJ:()=>i,Xq:()=>o,JY:()=>a,qv:()=>c});var n=r(8338),s=r(842);function i(e){if(s.toArrayBuffer&&(e=s.toArrayBuffer(e)),e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.buffer;if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}return e&&"object"==typeof e&&e._toArrayBuffer?e._toArrayBuffer():(0,n.Z)(!1)}function o(e,t,r){if(r=r||e.byteLength,e.byteLength<r||t.byteLength<r)return!1;const n=new Uint8Array(e),s=new Uint8Array(t);for(let e=0;e<n.length;++e)if(n[e]!==s[e])return!1;return!0}function a(...e){const t=e.map((e=>e instanceof ArrayBuffer?new Uint8Array(e):e)),r=t.reduce(((e,t)=>e+t.byteLength),0),n=new Uint8Array(r);let s=0;for(const e of t)n.set(e,s),s+=e.byteLength;return n.buffer}function c(e,t,r){const n=void 0!==r?new Uint8Array(e).subarray(t,t+r):new Uint8Array(e).subarray(t);return new Uint8Array(n).buffer}},1270:(e,t,r)=>{"use strict";r.d(t,{XJ:()=>s,Aj:()=>i,T_:()=>o});var n=r(2631);function s(e){return e+3&-4}function i(e,t,r){return(0,n.qv)(e,t,r)}function o(e,t,r){let n;if(e instanceof ArrayBuffer)n=new Uint8Array(e);else{const t=e.byteOffset,r=e.byteLength;n=new Uint8Array(e.buffer,t,r)}return t.set(n,r),r+s(n.byteLength)}},8338:(e,t,r)=>{"use strict";function n(e,t){if(!e)throw new Error(t||"loader assertion failed.")}r.d(t,{Z:()=>n})},8774:(e,t,r)=>{"use strict";r.d(t,{CO:()=>s,jU:()=>i,hJ:()=>o,T4:()=>c});const n={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==r.g&&r.g,document:"undefined"!=typeof document&&document},s=n.global||n.self||n.window,i="object"!=typeof process||"[object process]"!==String(process)||process.browser,o="function"==typeof importScripts,a="undefined"!=typeof process&&process.version&&process.version.match(/v([0-9]*)/),c=a&&parseFloat(a[1])||0},4550:(e,t,r)=>{"use strict";function n(e){const t=e&&e.lastIndexOf("/");return t>=0?e.substr(0,t):""}r.d(t,{X:()=>n})},9276:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var n=r(6789);const s={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class i{constructor(e={}){this.props={...s,...e},this.requestQueue=[],this.activeRequestCount=0,this.requestMap=new Map,this.stats=new n.Z({id:e.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever"),this._deferredUpdate=null}scheduleRequest(e,t=(()=>0)){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const r={handle:e,getPriority:t},n=new Promise((e=>(r.resolve=e,r)));return this.requestQueue.push(r),this.requestMap.set(e,n),this._issueNewRequests(),n}_issueRequest(e){const{handle:t,resolve:r}=e;let n=!1;const s=()=>{n||(n=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this._deferredUpdate||(this._deferredUpdate=setTimeout((()=>this._issueNewRequestsAsync()),0))}_issueNewRequestsAsync(){this._deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==e){this._updateAllRequests();for(let t=0;t<e;++t)if(this.requestQueue.length>0){const e=this.requestQueue.shift();this._issueRequest(e)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const r=e[t];this._updateRequest(r)||(e.splice(t,1),this.requestMap.delete(r.handle),t--)}e.sort(((e,t)=>e.priority-t.priority))}_updateRequest(e){return e.priority=e.getPriority(e.handle),!(e.priority<0)||(e.resolve(null),!1)}}},7866:(e,t,r)=>{"use strict";r.d(t,{Y:()=>N});var n=r(5550),s=r.n(n);class i{static get types(){return["Unknown","Point","LineString","Polygon"]}constructor(e,t,r,n,s){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=s,e.readFields(a,this,t)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos;let r=1,n=0,i=0,o=0;const a=[];let c;for(;e.pos<t;){if(n<=0){const t=e.readVarint();r=7&t,n=t>>3}if(n--,1===r||2===r)i+=e.readSVarint(),o+=e.readSVarint(),1===r&&(c&&a.push(c),c=[]),c.push(new(s())(i,o));else{if(7!==r)throw new Error("unknown command ".concat(r));c&&c.push(c[0].clone())}}return c&&a.push(c),a}bbox(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos;let r=1,n=0,s=0,i=0,o=1/0,a=-1/0,c=1/0,u=-1/0;for(;e.pos<t;){if(n<=0){const t=e.readVarint();r=7&t,n=t>>3}if(n--,1===r||2===r)s+=e.readSVarint(),i+=e.readSVarint(),s<o&&(o=s),s>a&&(a=s),i<c&&(c=i),i>u&&(u=i);else if(7!==r)throw new Error("unknown command ".concat(r))}return[o,c,a,u]}toGeoJSON(e,t,r){const n=this.extent*Math.pow(2,r),s=this.extent*e,a=this.extent*t;let c,u,l=this.loadGeometry(),h=i.types[this.type];function f(e){for(let t=0;t<e.length;t++){const r=e[t],i=180-360*(r.y+a)/n;e[t]=[360*(r.x+s)/n-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}switch(this.type){case 1:var d=[];for(c=0;c<l.length;c++)d[c]=l[c][0];l=d,f(l);break;case 2:for(c=0;c<l.length;c++)f(l[c]);break;case 3:for(l=function(e){const t=e.length;if(t<=1)return[e];const r=[];let n,s;for(let i=0;i<t;i++){const t=o(e[i]);0!==t&&(void 0===s&&(s=t<0),s===t<0?(n&&r.push(n),n=[e[i]]):n.push(e[i]))}n&&r.push(n);return r}(l),c=0;c<l.length;c++)for(u=0;u<l[c].length;u++)f(l[c][u])}1===l.length?l=l[0]:h="Multi".concat(h);return{type:"Feature",geometry:{type:h,coordinates:l},properties:this.properties}}}function o(e){let t=0;for(let r,n,s=0,i=e.length-1;s<e.length;i=s++)r=e[s],n=e[i],t+=(n.x-r.x)*(r.y+n.y);return t}function a(e,t,r){1===e?t.id=r.readVarint():2===e?function(e,t){const r=e.readVarint()+e.pos;for(;e.pos<r;){const r=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[r]=n}}(r,t):3===e?t.type=r.readVarint():4===e&&(t._geometry=r.pos)}class c{constructor(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(u,this,t),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const t=this._pbf.readVarint()+this._pbf.pos;return new i(this._pbf,t,this.extent,this._keys,this._values)}}function u(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(e){let t=null;const r=e.readVarint()+e.pos;for(;e.pos<r;){const r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(r))}class l{constructor(e,t){this.layers=e.readFields(h,{},t)}}function h(e,t,r){if(3===e){const e=new c(r,r.readVarint()+r.pos);e.length&&(t[e.name]=e)}}function f(e){let t=0,r=0,n=0,s=0,i=0,o=0,a=0,c=0,u=0;const l=new Set,h={};for(const d of e){const e=d.geometry;switch(e.type){case"Point":r++,t++,l.add(e.coordinates.length);break;case"MultiPoint":r++,t+=e.coordinates.length;for(const t of e.coordinates)l.add(t.length);break;case"LineString":i++,n+=e.coordinates.length,s++;for(const t of e.coordinates)l.add(t.length);break;case"MultiLineString":i++;for(const t of e.coordinates){n+=t.length,s++;for(const e of t)l.add(e.length)}break;case"Polygon":u++,a++,c+=e.coordinates.length,o+=E(e.coordinates).length;for(const t of E(e.coordinates))l.add(t.length);break;case"MultiPolygon":u++;for(const t of e.coordinates){a++,c+=t.length,o+=E(t).length;for(const e of E(t))l.add(e.length)}break;default:throw new Error("Unsupported geometry type: ".concat(e.type))}if(d.properties)for(const e in d.properties){const t=d.properties[e];h[e]=h[e]||void 0===h[e]?(f=t,Number.isFinite(f)):h[e]}}var f;return{pointPositionsCount:t,pointFeaturesCount:r,linePositionsCount:n,linePathsCount:s,lineFeaturesCount:i,coordLength:l.size>0&&Math.max(...l),polygonPositionsCount:o,polygonObjectsCount:a,polygonRingsCount:c,polygonFeaturesCount:u,numericPropKeys:Object.keys(h).filter((e=>h[e]))}}function d(e,t={},r={}){const{pointPositionsCount:n,pointFeaturesCount:s,linePositionsCount:i,linePathsCount:o,lineFeaturesCount:a,polygonPositionsCount:c,polygonObjectsCount:u,polygonRingsCount:l,polygonFeaturesCount:h}=t,{coordLength:f,numericPropKeys:d,PositionDataType:T=Float32Array}=r,A=e.length>65535?Uint32Array:Uint16Array,E={positions:new T(n*f),globalFeatureIds:new A(n),featureIds:s>65535?new Uint32Array(n):new Uint16Array(n),numericProps:{},properties:[]},I={pathIndices:i>65535?new Uint32Array(o+1):new Uint16Array(o+1),positions:new T(i*f),globalFeatureIds:new A(i),featureIds:a>65535?new Uint32Array(i):new Uint16Array(i),numericProps:{},properties:[]},v={polygonIndices:c>65535?new Uint32Array(u+1):new Uint16Array(u+1),primitivePolygonIndices:c>65535?new Uint32Array(l+1):new Uint16Array(l+1),positions:new T(c*f),globalFeatureIds:new A(c),featureIds:h>65535?new Uint32Array(c):new Uint16Array(c),numericProps:{},properties:[]};for(const e of[E,I,v])for(const t of d)e.numericProps[t]=new Float32Array(e.positions.length/f);I.pathIndices[o]=i,v.polygonIndices[u]=c,v.primitivePolygonIndices[l]=c;const x={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const t of e){const e=t.geometry,r=t.properties||{};switch(e.type){case"Point":p(e.coordinates,E,x,f,r),E.properties.push(w(r,d)),x.pointFeature++;break;case"MultiPoint":y(e.coordinates,E,x,f,r),E.properties.push(w(r,d)),x.pointFeature++;break;case"LineString":g(e.coordinates,I,x,f,r),I.properties.push(w(r,d)),x.lineFeature++;break;case"MultiLineString":m(e.coordinates,I,x,f,r),I.properties.push(w(r,d)),x.lineFeature++;break;case"Polygon":b(e.coordinates,v,x,f,r),v.properties.push(w(r,d)),x.polygonFeature++;break;case"MultiPolygon":_(e.coordinates,v,x,f,r),v.properties.push(w(r,d)),x.polygonFeature++;break;default:throw new Error("Invalid geometry type")}x.feature++}return function(e,t,r,n){const s={points:{positions:{value:e.positions,size:n},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:e.numericProps,properties:e.properties},lines:{pathIndices:{value:t.pathIndices,size:1},positions:{value:t.positions,size:n},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:t.numericProps,properties:t.properties},polygons:{polygonIndices:{value:r.polygonIndices,size:1},primitivePolygonIndices:{value:r.primitivePolygonIndices,size:1},positions:{value:r.positions,size:n},globalFeatureIds:{value:r.globalFeatureIds,size:1},featureIds:{value:r.featureIds,size:1},numericProps:r.numericProps,properties:r.properties}};for(const e in s)for(const t in s[e].numericProps)s[e].numericProps[t]={value:s[e].numericProps[t],size:1};return s}(E,I,v,f)}function p(e,t,r,n,s){t.positions.set(e,r.pointPosition*n),t.globalFeatureIds[r.pointPosition]=r.feature,t.featureIds[r.pointPosition]=r.pointFeature,T(t,s,r.pointPosition,1),r.pointPosition++}function y(e,t,r,n,s){for(const i of e)p(i,t,r,n,s)}function g(e,t,r,n,s){t.pathIndices[r.linePath]=r.linePosition,r.linePath++,A(t.positions,e,r.linePosition,n);const i=e.length;T(t,s,r.linePosition,i),t.globalFeatureIds.set(new Uint32Array(i).fill(r.feature),r.linePosition),t.featureIds.set(new Uint32Array(i).fill(r.lineFeature),r.linePosition),r.linePosition+=i}function m(e,t,r,n,s){for(const i of e)g(i,t,r,n,s)}function b(e,t,r,n,s){t.polygonIndices[r.polygonObject]=r.polygonPosition,r.polygonObject++;for(const i of e){t.primitivePolygonIndices[r.polygonRing]=r.polygonPosition,r.polygonRing++,A(t.positions,i,r.polygonPosition,n);const e=i.length;T(t,s,r.polygonPosition,e),t.globalFeatureIds.set(new Uint32Array(e).fill(r.feature),r.polygonPosition),t.featureIds.set(new Uint32Array(e).fill(r.polygonFeature),r.polygonPosition),r.polygonPosition+=e}}function _(e,t,r,n,s){for(const i of e)b(i,t,r,n,s)}function T(e,t,r,n){for(const s in e.numericProps)s in t&&e.numericProps[s].set(new Array(n).fill(t[s]),r)}function w(e,t){const r={};for(const n in e)t.includes(n)||(r[n]=e[n]);return r}function A(e,t,r,n){let s=r*n;for(const r of t)e.set(r,s),s+=n}function E(e){return[].concat(...e)}var I=r(3614),v=r.n(I);const x=["Unknown","Point","LineString","Polygon"];function O(e,t){for(let r=0;r<e.length;r++){const n=e[r];e[r]=[n.x/t.extent,n.y/t.extent]}}function S(e,t=((e,t)=>e)){const r=x[e.type];let n=e.loadGeometry();switch(e.type){case 1:const r=[];for(let e=0;e<n.length;e++)r[e]=n[e][0];n=r,t(n,e);break;case 2:for(let r=0;r<n.length;r++)t(n[r],e);break;case 3:n=function(e){const t=e.length;if(t<=1)return[e];const r=[];let n,s;for(let i=0;i<t;i++){const t=P(e[i]);0!==t&&(void 0===s&&(s=t<0),s===t<0?(n&&r.push(n),n=[e[i]]):n&&n.push(e[i]))}n&&r.push(n);return r}(n);for(let r=0;r<n.length;r++)for(let s=0;s<n[r].length;s++)t(n[r][s],e)}return function(e,t,r){let n=e;1===r.length?r=r[0]:n="Multi".concat(e);const s={type:"Feature",geometry:{type:n,coordinates:r},properties:t.properties||{}};"id"in t&&(s.id=t.id);return s}(r,e,n)}function P(e){const t=e.length;let r,n,s=0;for(let i=0,o=t-1;i<t;o=i++)r=e[i],n=e[o],s+=(n.x-r.x)*(r.y+n.y);return s}function C(e,t){(t=t||{}).mvt=t.mvt||{},t.gis=t.gis||{};const r=[];if(e.byteLength>0){const n=new l(new(v())(e)),s=t.mvt;(Array.isArray(s.layers)?s.layers:Object.keys(n.layers)).forEach((e=>{const t=n.layers[e],i={...s,layerName:e};if(t)for(let e=0;e<t.length;e++){const n=R(t.feature(e),i);r.push(n)}}))}if("binary"===t.gis.format){const t=function(e,t={}){const r=f(e);return d(e,r,{coordLength:t.coordLength||r.coordLength||2,numericPropKeys:t.numericPropKeys||r.numericPropKeys,PositionDataType:t.PositionDataType||Float32Array})}(r);return t.byteLength=e.byteLength,t}return r}function R(e,t={}){const r="wgs84"===t.coordinates,n=t.tileIndex&&Number.isFinite(t.tileIndex.x)&&Number.isFinite(t.tileIndex.y)&&Number.isFinite(t.tileIndex.z);if(r&&!n)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property. Check documentation.");const s=r&&n?e.toGeoJSON(t.tileIndex.x,t.tileIndex.y,t.tileIndex.z):S(e,O);return t.layerProperty&&(s.properties[t.layerProperty]=t.layerName),s}const U="2.3.13",N={...{id:"mvt",name:"Mapbox Vector Tile",version:U,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],category:"geometry",options:{mvt:{coordinates:"local",layerProperty:"layerName",layers:null,tileIndex:null,_format:"geojson",workerUrl:"https://unpkg.com/@loaders.gl/mvt@".concat(U,"/dist/mvt-loader.worker.js")}}},parse:async(e,t)=>C(e,t),parseSync:C,binary:!0}},3405:(e,t,r)=>{"use strict";r.d(t,{x:()=>a});var n=r(1674),s=r(4449);function i(e,t){if(null===e)return null;const{meshMaxError:r,bounds:i,elevationDecoder:o}=t,a=e.data,c=e.width,u=c+1,l=function(e,t,r){const{rScaler:n,bScaler:s,gScaler:i,offset:o}=r,a=t+1,c=new Float32Array(a*a);for(let r=0,a=0;a<t;a++)for(let u=0;u<t;u++,r++){const t=4*r,u=e[t+0],l=e[t+1],h=e[t+2];c[r+a]=u*n+l*i+h*s+o}for(let e=a*(a-1),t=0;t<a-1;t++,e++)c[e]=c[e-a];for(let e=a-1,t=0;t<a;t++,e+=a)c[e]=c[e-1];return c}(a,c,o),h=new n.Z(u).createTile(l),{vertices:f,triangles:d}=h.getMesh(r),p=function(e,t,r,n){const s=r+1,i=e.length/2,o=new Float32Array(3*i),a=new Float32Array(2*i),[c,u,l,h]=n||[0,0,r,r],f=(l-c)/r,d=(h-u)/r;for(let n=0;n<i;n++){const i=e[2*n],u=e[2*n+1],l=u*s+i;o[3*n+0]=i*f+c,o[3*n+1]=-u*d+h,o[3*n+2]=t[l],a[2*n+0]=i/r,a[2*n+1]=u/r}return{POSITION:{value:o,size:3},TEXCOORD_0:{value:a,size:2}}}(f,l,c,i);return{loaderData:{header:{}},header:{vertexCount:d.length,boundingBox:(0,s.v)(p)},mode:4,indices:{value:d,size:1},attributes:p}}const o="2.3.13",a={...{id:"terrain",name:"Terrain",version:o,extensions:["png","pngraw"],mimeTypes:["image/png"],options:{terrain:{bounds:null,workerUrl:"https://unpkg.com/@loaders.gl/terrain@".concat(o,"/dist/terrain-loader.worker.js"),meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0}}}},parse:async function(e,t,r){return t.image=t.image||{},t.image.type="data",i(await r.parse(e,t,t.baseUri),t.terrain)}}},8744:(e,t,r)=>{"use strict";r.d(t,{Qb:()=>n,F$:()=>s,R7:()=>i,i3:()=>o,ci:()=>a,fB:()=>c});const n={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},s={ADD:1,REPLACE:2},i={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},o={I3S:"I3S",TILES3D:"TILES3D"},a={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},c={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0}},5562:(e,t,r)=>{"use strict";r.d(t,{Z:()=>ae});var n=r(2425),s=r(7720),i=r(8581),o=r(6789),a=r(8338),c=r(4550),u=r(9276);class l{constructor(e,t,r){this.item=e,this.previous=t,this.next=r}}class h{constructor(){this.head=null,this.tail=null,this._length=0}get length(){return this._length}add(e){const t=new l(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const r=e.next;e.next=t,this.tail===e?this.tail=t:r.previous=t,t.next=r,t.previous=e,++this._length}}function f(e){return null!=e}class d{constructor(){this._list=new h,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;f(t)&&this._list.splice(this._sentinel,t)}add(e,t,r){f(t._cacheNode)||(t._cacheNode=this._list.add(t),r&&r(e,t))}unloadTile(e,t,r){const n=t._cacheNode;f(n)&&(this._list.remove(n),t._cacheNode=void 0,r&&r(e,t))}unloadTiles(e,t){const r=this._trimTiles;this._trimTiles=!1;const n=this._list,s=1024*e.maximumMemoryUsage*1024,i=this._sentinel;let o=n.head;for(;o!==i&&(e.gpuMemoryUsageInBytes>s||r);){const r=o.item;o=o.next,this.unloadTile(e,r,t)}}trim(){this._trimTiles=!0}}var p=r(692);const y=new s.Z,g=new s.Z,m=new p.Mh([new p.JO,new p.JO,new p.JO,new p.JO,new p.JO,new p.JO]);function b(e,t){const{cameraDirection:r,cameraUp:n,height:o}=e,{metersPerUnit:a}=e.distanceScales,c=[e.longitude,e.latitude,0],u=i.H.WGS84.cartographicToCartesian(c,new s.Z),l=i.H.WGS84.eastNorthUpToFixedFrame(u),h=e.unprojectPosition(e.cameraPosition),f=i.H.WGS84.cartographicToCartesian(h,new s.Z),d=new s.Z(l.transformAsVector(new s.Z(r).scale(a))).normalize(),p=new s.Z(l.transformAsVector(new s.Z(n).scale(a))).normalize();return function(e,t){const r=e.getFrustumPlanes();let n=0;for(const o in r){const a=r[o],c=a.normal.dot(e.center);g.copy(a.normal).scale(a.distance-c).add(e.center);const u=e.unprojectPosition(g),l=i.H.WGS84.cartographicToCartesian(u,new s.Z);m.planes[n++].fromPointNormal(l,y.copy(t).subtract(l))}}(e,u),{camera:{position:f,direction:d,up:p},viewport:e,height:o,cullingVolume:m,frameNumber:t,sseDenominator:1.15}}const _=6378137,T=6378137,w=6356752.314245179,A=new s.Z;var E=r(5431),I=r(8744),v=r(7898),x=r(5109);function O(e){return null!=e}const S=new s.Z,P=new s.Z,C=new s.Z;new n.Z;function R(e,t,r){if((0,a.Z)(e,"3D Tile: boundingVolume must be defined"),e.box)return function(e,t,r){const n=new s.Z(e[0],e[1],e[2]);t.transform(n,n);const i=t.transformAsVector(e.slice(3,6)),o=t.transformAsVector(e.slice(6,9)),a=t.transformAsVector(e.slice(9,12)),c=new x.Z([i[0],i[1],i[2],o[0],o[1],o[2],a[0],a[1],a[2]]);if(O(r))return r.center=n,r.halfAxes=c,r;return new p.F7(n,c)}(e.box,t,r);if(e.region){const[t,r,o,a,c,u]=e.region,l=i.H.WGS84.cartographicToCartesian([(0,v.RW)(t),(0,v.RW)(a),c],P),h=i.H.WGS84.cartographicToCartesian([(0,v.RW)(o),(0,v.RW)(r),u],C),f=(new s.Z).addVectors(l,h).multiplyScalar(.5),d=(new s.Z).subVectors(l,h).len()/2;return U([f[0],f[1],f[2],d],new n.Z)}if(e.sphere)return U(e.sphere,t,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function U(e,t,r){const n=new s.Z(e[0],e[1],e[2]);t.transform(n,n);const i=t.getScale(S),o=Math.max(Math.max(i[0],i[1]),i[2]),a=e[3]*o;return O(r)?(r.center=n,r.radius=a,r):new p.KM(n,a)}new s.Z,new s.Z,new n.Z,new s.Z,new s.Z,new s.Z;function N(e,t){if(e.dynamicScreenSpaceError&&e._dynamicScreenSpaceErrorComputedDensity){const r=e._dynamicScreenSpaceErrorComputedDensity,n=e.dynamicScreenSpaceErrorFactor;return function(e,t){const r=e*t;return 1-Math.exp(-r*r)}(t,r)*n}return 0}const M=6378137,L=Math.PI/2;function D([e,t,r]){const n=(0,v.Yr)(e),s=(0,v.Yr)(t),i=1+r/M,o=i*Math.cos(s);return[e=o*Math.cos(n),t=o*Math.sin(n),r=i*Math.sin(s)]}function V([e,t,r=0],[n,s,i=0]){const o=D([n,s,i]),a=D([e,t,r]),c=a[0]-o[0],u=a[1]-o[1],l=a[2]-o[2];return c*c+u*u+l*l}function B(e,t){const r=t.viewport,n=e.header.mbs[1],s=e.header.mbs[0],i=e.header.mbs[2],o=e.header.mbs[3],a=[s,n,i],c=V(r.unprojectPosition(r.cameraPosition),a),u=o/M,l=c-u*u;if(l<=0)return 170141175e30;let h=function(e,t){const{width:r,height:n,pixelProjectionMatrix:s}=t.viewport,i=Math.tan(Math.atan(Math.sqrt(1/(s[0]*s[0])+1/(s[5]*s[5]))));return Math.sqrt(n*n+r*r)/i}(0,t);return h*=u/Math.sqrt(l)/r.scale,h}const j=new s.Z;class k{constructor(e,t,r){(0,a.Z)("object"==typeof t),this.header=t,this.tileset=e,this.id=t.id,this.url=t.url,this.parent=r,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this.lodMetricType=null,this.lodMetricValue=null,this.boundingVolume=null,this.content=null,this.contentState=I.Qb.UNLOADED,this.gpuMemoryUsageInBytes=0,this.children=[],this.depth=0,this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,this._getPriority=this._getPriority.bind(this),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return null===this.header}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===I.Qb.READY||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===I.Qb.UNLOADED}get contentExpired(){return this.contentState===I.Qb.EXPIRED}get contentFailed(){return this.contentState===I.Qb.FAILED}getScreenSpaceError(e,t){switch(this.tileset.type){case I.i3.I3S:return B(this,e);case I.i3.TILES3D:return function(e,t,r){const n=e.tileset,s=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,i=r?s:e.lodMetricValue;if(0===i)return 0;const o=Math.max(e._distanceToCamera,1e-7),{height:a,sseDenominator:c}=t;let u=i*a/(o*c);return u-=N(n,o),u}(this,e,t);default:return console.error("Unsupported tileset type"),null}}_getPriority(){return this.isVisible?this.contentState===I.Qb.UNLOADED?-1:Math.max(1e7-this._priority,0)||0:-1}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=I.Qb.LOADING;const e=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority);if(!e)return this.contentState=I.Qb.UNLOADED,!1;try{const t=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.fetchOptions,n=this.tileset.loader,s={...r,[n.id]:{tile:this.header,tileset:this.tileset.tileset,isTileset:"auto",isTileHeader:!1,assetGltfUpAxis:this.tileset.asset.gltfUpAxis}};return this.content=await(0,E.z)(t,n,s),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this,c.X(this.contentUrl)),this.contentState=I.Qb.READY,this._onContentLoaded(),!0}catch(e){throw this.contentState=I.Qb.FAILED,e}finally{e.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.contentState=I.Qb.UNLOADED,!0}updateVisibility(e){if(this._frameNumber===e.frameNumber)return;const t=this.parent,r=t?t.computedTransform:this.tileset.modelMatrix,n=t?t._visibilityPlaneMask:p.Mh.MASK_INDETERMINATE;this._updateTransform(r),this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,n),this._visible=this._visibilityPlaneMask!==p.Mh.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._priority=this.lodMetricValue,this._frameNumber=e.frameNumber}visibility(e,t){const{cullingVolume:r}=e,{boundingVolume:n}=this;return r.computeVisibilityWithPlaneMask(n,t)}contentVisibility(e){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const t=this.boundingVolume;return j.subVectors(t.center,e.position),e.direction.dot(j)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||0===t.distanceToCamera(e.camera.position)}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new n.Z(e.transform):new n.Z;const t=this.parent,r=this.tileset,s=t&&t.computedTransform?t.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new n.Z(s).multiplyRight(this.transform);const i=t&&t._initialTransform?t._initialTransform.clone():new n.Z;this._initialTransform=new n.Z(i).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=I.Qb.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level,this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=p.Mh.MASK_INDETERMINATE,this._visible=!1,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||I.F$.REPLACE}_isTileset(){return-1!==this.contentUrl.indexOf(".json")}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset.traverser.disableSkipLevelOfDetail=!0}this._isTileset()&&(this.hasTilesetContent=!0)}_updateBoundingVolume(e){this.boundingVolume=R(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=R(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=R(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new n.Z){const t=e.clone().multiplyRight(this.transform);!t.equals(this.computedTransform)&&(this.computedTransform=t,this._updateBoundingVolume(this.header))}updateExpiration(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=I.Qb.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}}class F{constructor(e=0){this._array=new Array(e),this._map=new Map,this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return(0,a.Z)(e<this._array.length),this._array[e]}set(e,t){(0,a.Z)(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){(0,a.Z)(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){(0,a.Z)(e>=0),this.length=e}trim(e){null==e&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const G={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2};class q{constructor(e){this.options={...G,...e},this._traversalStack=new F,this._emptyTraversalStack=new F,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={}}traverse(e,t,r){this.root=e,this.options={...this.options,...r},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const r=this._traversalStack;for(r.push(e);r.length>0;){const e=r.pop();let n=!1;this.canTraverse(e,t)&&(this.updateChildTiles(e,t),n=this.updateAndPushChildren(e,t,r));const s=e.parent,i=Boolean(!s||s._shouldRefine),o=!n;e.hasRenderContent?e.refine===I.F$.ADD?(this.loadTile(e,t),this.selectTile(e,t)):e.refine===I.F$.REPLACE&&(this.loadTile(e,t),o&&this.selectTile(e,t)):(this.emptyTiles[e.id]=e,this.loadTile(e,t),o&&this.selectTile(e,t)),this.touchTile(e,t),e._shouldRefine=n&&i}this.options.onTraversalEnd&&this.options.onTraversalEnd(t)}updateChildTiles(e,t){const r=e.children;for(const e of r)this.updateTile(e,t);return!0}updateAndPushChildren(e,t,r){const{loadSiblings:n,skipLevelOfDetail:s}=this.options,i=e.children;i.sort(this.compareDistanceToCamera);const o=!s&&e.refine===I.F$.REPLACE&&e.hasRenderContent;let a=!1;for(const e of i)if(e.isVisibleAndInRequestVolume?(r.find(e)&&r.delete(e),r.push(e),a=!0):(o||n)&&(this.loadTile(e,t),this.touchTile(e,t)),o){let r;if(r=!!e._inRequestVolume&&(e.hasRenderContent?e.contentAvailable:this.executeEmptyTraversal(e,t)),!r)return r}return a}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e,t)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e,t)&&(e._requestedFrame=t.frameNumber,e._priority=this.getPriority(e),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t,r=!1,n=!1){return!(!n&&!e.isVisibleAndInRequestVolume)&&(!!e.hasChildren&&(e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,t,r)))}shouldLoadTile(e,t){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e,t){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t,r){let n=e._screenSpaceError;return r&&(n=e.getScreenSpaceError(t,!0)),n>this.options.maximumScreenSpaceError}updateTileVisibility(e,t){e.updateVisibility(t)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}getPriority(e){const{options:t}=this;switch(e.refine){case I.F$.ADD:return e._distanceToCamera;case I.F$.REPLACE:const{parent:r}=e,n=r&&(!t.skipLevelOfDetail||0===e._screenSpaceError||r.hasTilesetContent)?r._screenSpaceError:e._screenSpaceError;return this.root._screenSpaceError-n;default:return(0,a.Z)(!1)}}anyChildrenVisible(e,t){let r=!1;for(const n of e.children)n.updateVisibility(t),r=r||n.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(e,t){let r=!0;const n=this._emptyTraversalStack;for(;n.length>0;){const e=n.pop();this.updateTile(e,t),e.isVisibleAndInRequestVolume||(this.loadTile(e,t),this.touchTile(e,t));const s=!e.hasRenderContent&&this.canTraverse(e,t,!1,!0);if(s||e.contentAvailable||(r=!1),s){const t=e.children.filter((e=>e));for(const e of t)n.find(e)&&n.delete(e),n.push(e)}}return r}}class z extends q{compareDistanceToCamera(e,t){return 0===t._distanceToCamera&&0===e._distanceToCamera?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(e.updateVisibility(t),!e.isVisibleAndInRequestVolume)return;const r=e.children.length>0;if(e.hasTilesetContent&&r){const r=e.children[0];return this.updateTileVisibility(r,t),void(e._visible=r._visible)}if(this.meetsScreenSpaceErrorEarly(e,t))return void(e._visible=!1);const n=e.refine===I.F$.REPLACE,s=e._optimChildrenWithinParent===I.fB.USE_OPTIMIZATION;n&&s&&r&&!this.anyChildrenVisible(e,t)&&(e._visible=!1)}meetsScreenSpaceErrorEarly(e,t){const{parent:r}=e;return!(!r||r.hasTilesetContent||r.refine!==I.F$.ADD)&&!this.shouldRefine(e,t,!0)}}const Z="REQUESTED",H="COMPLETED",W="ERROR";class Q{constructor(){this._statusMap={}}add(e,t,r,n){this._statusMap[t]||(this._statusMap[t]={request:e,callback:r,key:t,frameState:n,status:Z},e().then((e=>{this._statusMap[t].status=H,this._statusMap[t].callback(e,n)})).catch((e=>{this._statusMap[t].status=W,r(e)})))}update(e,t){this._statusMap[e]&&(this._statusMap[e].frameState=t)}find(e){return this._statusMap[e]}}class J extends q{constructor(e){super(e),this._tileManager=new Q}shouldRefine(e,t){return e._lodJudge=function(e,t){const r=t.viewport,n=r.metersPerPixel,s=e.header.mbs[1],i=e.header.mbs[0],o=e.header.mbs[2],a=e.header.mbs[3],{height:c,width:u,latitude:l,longitude:h}=r,f=[h,l],d=[i,s,o],p=[h,s],y=[i,l],g=Math.sqrt(c*c+u*u)*n[0],m=V(f,d),b=.5*c+a/M,_=.5*u+a/M;if(m>g+a/M)return"OUT";if(V(f,p)>b)return"OUT";if(V(f,y)>_)return"OUT";if(0===e.lodMetricValue)return"DIG";let T=B(e,t);return T*=L,T<.5?"OUT":!e.header.children||T<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}(e,t),"DIG"===e._lodJudge}updateChildTiles(e,t){const r=e.header.children||[],n=e.children,s=e.tileset;for(const i of r){const r=n&&n.find((e=>e.id===i.id));if(r)r&&this.updateTile(r,t);else{let r=()=>this._loadTile(i.id,s);this._tileManager.find(i.id)?this._tileManager.update(i.id,t):(s.tileset.nodePages&&(r=()=>s.tileset.nodePagesTile.formTileFromNodePages(i.id)),this._tileManager.add(r,i.id,(t=>this._onTileLoad(t,e)),t))}}}async _loadTile(e,t){const{loader:r}=t,n=t.getTileUrl("".concat(t.url,"/nodes/").concat(e)),s={i3s:{...t.fetchOptions,isTileHeader:!0,loadContent:!1}};return await(0,E.z)(n,r,s)}_onTileLoad(e,t){const r=this.options.basePath,n=new k(t.tileset,e,t,r);t.children.push(n);const s=this._tileManager.find(n.id).frameState;this.updateTile(n,s),this._frameNumber===s.frameNumber&&this.executeTraversal(n,s)}}const Y="Tiles In Tileset(s)",X="Tiles In Memory",K="Tiles In View",$="Tiles To Render",ee="Tiles Loaded",te="Tiles Loading",re="Tiles Unloaded",ne="Failed Tile Loads",se="Points",ie="Tile Memory Use";const oe={ellipsoid:i.H.WGS84,modelMatrix:new n.Z,throttleRequests:!1,maximumMemoryUsage:32,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:(e,t,r)=>{},maximumScreenSpaceError:8};class ae{constructor(e,t={}){(0,a.Z)(e),this.options={...oe,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||c.X(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.fetchOptions=this.options.fetchOptions||{},this.options.headers&&(this.fetchOptions.headers=this.options.headers),this.options.token&&(this.fetchOptions.token=this.options.token),this.root=null,this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this._traverser=this._initializeTraverser(),this._cache=new d,this._requestScheduler=new u.Z({throttleRequests:this.options.throttleRequests}),this._frameNumber=0,this._updateFrameNumber=0,this._pendingCount=0,this._tiles={},this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this._queryParams={},this._queryParamsString=null,this.maximumMemoryUsage=this.options.maximumMemoryUsage,this.gpuMemoryUsageInBytes=0,this.stats=new o.Z({id:this.url}),this._initializeStats(),this._hasMixedContent=!1,this._maximumScreenSpaceError=this.options.maximumScreenSpaceError,this._properties=void 0,this._extensionsUsed=void 0,this._gltfUpAxis=void 0,this._dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description,this._defaultGeometrySchema=[],this._initializeTileSet(e,this.options)}isLoaded(){return 0===this._pendingCount}destroy(){this._destroy()}get tiles(){return Object.values(this._tiles)}getTileUrl(e){return e.startsWith("data:")?e:"".concat(e).concat(this.queryParams)}update(e){this._cache.reset(),this._frameNumber++,this._frameState=b(e,this._frameNumber),this._traverser.traverse(this.root,this._frameState,this.options)}_onTraversalEnd(){const e=Object.values(this._traverser.selectedTiles);this._tilesChanged(this.selectedTiles,e)&&this._updateFrameNumber++,this.selectedTiles=e;for(const e of this.selectedTiles)this._tiles[e.id]=e;return this._requestedTiles=Object.values(this._traverser.requestedTiles),this._emptyTiles=Object.values(this._traverser.emptyTiles),this._loadTiles(this._frameState),this._unloadTiles(),this._updateStats(),this._updateFrameNumber}_tilesChanged(e,t){if(e.length!==t.length)return!0;const r=new Set(e.map((e=>e.id))),n=new Set(t.map((e=>e.id)));let s=e.filter((e=>!n.has(e.id))).length>0;return s=s||t.filter((e=>!r.has(e.id))).length>0,s}_loadTiles(e){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t,e)}_unloadTiles(){this._cache.unloadTiles(this,((e,t)=>e._unloadTile(t)))}_updateStats(){let e=0,t=0;for(const r of this.selectedTiles)r.contentAvailable&&(e++,r.content.pointCount&&(t+=r.content.pointCount));this.stats.get(K).count=this.selectedTiles.length,this.stats.get($).count=e,this.stats.get(se).count=t}_initializeTileSet(e){this.root=this._initializeTileHeaders(e,null,this.basePath),this.type===I.i3.TILES3D&&this._initializeCesiumTileset(e),this.type===I.i3.I3S&&this._initializeI3STileset(e),this._calculateViewProps()}_calculateViewProps(){const e=this.root,{center:t}=e.boundingVolume;if(!t)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new s.Z,void(this.zoom=1);this.cartographicCenter=i.H.WGS84.cartesianToCartographic(t,new s.Z),this.cartesianCenter=t,this.zoom=function(e){const{halfAxes:t,radius:r,width:n,height:s}=e;if(t){t.getColumn(0,A);const e=A.len();t.getColumn(1,A);const r=A.len();t.getColumn(2,A);const n=e/2,s=r/2,i=A.len()/2;return(Math.log2(_/n)+Math.log2(T/s)+Math.log2(w/i))/3}if(r)return Math.log2(w/r);if(s&&n)return(Math.log2(_/n)+Math.log2(T/s))/2;return 1}(e.boundingVolume)}_initializeStats(){this.stats.get(Y),this.stats.get(te),this.stats.get(X),this.stats.get(K),this.stats.get($),this.stats.get(ee),this.stats.get(re),this.stats.get(ne),this.stats.get(se,"memory"),this.stats.get(ie,"memory")}_initializeTileHeaders(e,t,r){const n=new k(this,e.root,t,r);if(t&&(t.children.push(n),n.depth=t.depth+1),this.type===I.i3.TILES3D){const e=[];for(e.push(n);e.length>0;){const t=e.pop();this.stats.get(Y).incrementCount();const n=t.header.children||[];for(const s of n){const n=new k(this,s,t,r);t.children.push(n),n.depth=t.depth+1,e.push(n)}}}return n}_initializeTraverser(){let e;switch(this.type){case I.i3.TILES3D:e=z;break;case I.i3.I3S:e=J;break;default:e=q}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e,t){let r;try{this._onStartTileLoading(),r=await e.loadContent(t)}catch(t){this._onTileLoadError(e,t)}finally{this._onEndTileLoading(),this._onTileLoad(e,r)}}_onTileLoadError(e,t){this.stats.get(ne).incrementCount();const r=t.message||t.toString(),n=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(r)),this.options.onTileError(e,r,n)}_onTileLoad(e,t){t&&(e&&e.content&&function(e,t){(0,a.Z)(e),(0,a.Z)(t);const{rtcCenter:r,gltfUpAxis:o}=t,{computedTransform:c,boundingVolume:{center:u}}=e;let l=new n.Z(c);switch(r&&l.translate(r),o){case"Z":break;case"Y":const e=(new n.Z).rotateX(Math.PI/2);l=l.multiplyRight(e);break;case"X":const t=(new n.Z).rotateY(-Math.PI/2);l=l.multiplyRight(t)}t.isQuantized&&l.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const h=new s.Z(u);t.cartesianModelMatrix=l,t.cartesianOrigin=h;const f=i.H.WGS84.cartesianToCartographic(h,new s.Z),d=i.H.WGS84.eastNorthUpToFixedFrame(h).invert();t.cartographicModelMatrix=d.multiplyRight(l),t.cartographicOrigin=f,t.modelMatrix=t.cartographicModelMatrix}(e,e.content),this._addTileToCache(e),this.options.onTileLoad(e))}_onStartTileLoading(){this._pendingCount++,this.stats.get(te).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(te).decrementCount()}_addTileToCache(e){this._cache.add(this,e,(t=>t._updateCacheStats(e)))}_updateCacheStats(e){this.stats.get(ee).incrementCount(),this.stats.get(X).incrementCount(),this.gpuMemoryUsageInBytes+=e.content.byteLength||0,this.stats.get(ie).count=this.gpuMemoryUsageInBytes}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.content.byteLength||0,this.stats.get(X).decrementCount(),this.stats.get(re).incrementCount(),this.stats.get(ie).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const r of t.children)e.push(r);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,r=[];for(r.push(t);r.length>0;){e=r.pop();for(const t of e.children)r.push(t);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeCesiumTileset(e){if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description,this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed,this.extras=e.extras}_initializeI3STileset(e){"token"in this.options&&(this._queryParams.token=this.options.token),this._defaultGeometrySchema=e.store.defaultGeometrySchema}hasExtension(e){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(e)>-1)}get queryParams(){return this._queryParamsString||(this._queryParamsString=function(e){const t=[];for(const r of Object.keys(e))t.push("".concat(r,"=").concat(e[r]));switch(t.length){case 0:return"";case 1:return"?".concat(t[0]);default:return"?".concat(t.join("&"))}}(this._queryParams)),this._queryParamsString}}}}]);